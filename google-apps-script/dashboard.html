<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gradebook System Dashboard | æˆç¸¾ç°¿ç³»çµ±æ§åˆ¶å°</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-icon {
            font-size: 2rem;
            margin-right: 15px;
            padding: 15px;
            border-radius: 10px;
            color: white;
        }

        .system-status .card-icon { background: #4CAF50; }
        .quick-stats .card-icon { background: #2196F3; }
        .system-controls .card-icon { background: #FF9800; }
        .progress-overview .card-icon { background: #9C27B0; }

        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #333;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-weight: 500;
            color: #666;
        }

        .stat-value {
            font-weight: 600;
            color: #333;
            padding: 5px 10px;
            background: #f5f5f5;
            border-radius: 5px;
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #2196F3;
            color: white;
        }

        .btn-secondary:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #FF9800;
            color: white;
        }

        .btn-warning:hover {
            background: #F57C00;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-excellent { background: #4CAF50; }
        .status-good { background: #FFC107; }
        .status-warning { background: #FF9800; }
        .status-error { background: #f44336; }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #eee;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .alert {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .bilingual {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .control-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ“Š Gradebook System Dashboard</h1>
            <p>æˆç¸¾ç°¿ç®¡ç†ç³»çµ±æ§åˆ¶å°</p>
            <div class="bilingual">Complete Google-based gradebook solution with bilingual support<br>å®Œå…¨åŸºæ–¼ Google çš„æˆç¸¾ç®¡ç†è§£æ±ºæ–¹æ¡ˆï¼Œå«é›™èªæ”¯æ´</div>
        </div>

        <!-- Alert Messages -->
        <div id="alert-success" class="alert alert-success"></div>
        <div id="alert-error" class="alert alert-error"></div>

        <!-- Loading Indicator -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Processing... | è™•ç†ä¸­...</p>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- System Status Card -->
            <div class="card system-status">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-heartbeat"></i>
                    </div>
                    <div>
                        <div class="card-title">System Status | ç³»çµ±ç‹€æ…‹</div>
                        <div class="bilingual">Real-time system health monitoring</div>
                    </div>
                </div>
                <div class="stat-item">
                    <span class="stat-label">System Health | ç³»çµ±å¥åº·åº¦</span>
                    <span class="stat-value">
                        <span class="status-indicator status-excellent"></span>
                        Excellent | å„ªç§€
                    </span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Last Updated | æœ€å¾Œæ›´æ–°</span>
                    <span class="stat-value" id="last-updated">Loading...</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Semester | å­¸æœŸ</span>
                    <span class="stat-value">2425S2</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Version | ç‰ˆæœ¬</span>
                    <span class="stat-value">Dashboard v3.0</span>
                </div>
            </div>

            <!-- Quick Statistics Card -->
            <div class="card quick-stats">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div>
                        <div class="card-title">Quick Statistics | å¿«é€Ÿçµ±è¨ˆ</div>
                        <div class="bilingual">Real-time system metrics</div>
                    </div>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Total Teachers | è€å¸«ç¸½æ•¸</span>
                    <span class="stat-value" id="total-teachers">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Total Students | å­¸ç”Ÿç¸½æ•¸</span>
                    <span class="stat-value" id="total-students">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Active Gradebooks | æ´»èºæˆç¸¾ç°¿</span>
                    <span class="stat-value" id="active-gradebooks">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">System Files | ç³»çµ±æª”æ¡ˆ</span>
                    <span class="stat-value" id="system-files">0</span>
                </div>
            </div>

            <!-- System Controls Card -->
            <div class="card system-controls">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <div>
                        <div class="card-title">System Controls | ç³»çµ±æ§åˆ¶</div>
                        <div class="bilingual">One-click system management</div>
                    </div>
                </div>
                <div class="control-grid">
                    <button class="btn btn-primary" onclick="initializeSystem()">
                        <i class="fas fa-rocket"></i> Initialize | åˆå§‹åŒ–
                    </button>
                    <button class="btn btn-secondary" onclick="checkSystemStatus()">
                        <i class="fas fa-stethoscope"></i> Check Status | æª¢æŸ¥ç‹€æ…‹
                    </button>
                    <button class="btn btn-warning" onclick="refreshDashboard()">
                        <i class="fas fa-sync-alt"></i> Refresh | é‡æ–°æ•´ç†
                    </button>
                    <button class="btn btn-secondary" onclick="openSystemFolder()">
                        <i class="fas fa-folder-open"></i> System Folder | ç³»çµ±è³‡æ–™å¤¾
                    </button>
                    <button class="btn btn-secondary" onclick="openMasterData()">
                        <i class="fas fa-database"></i> Master Data | ä¸»æ§è³‡æ–™
                    </button>
                    <button class="btn btn-warning" onclick="updateTeachers()">
                        <i class="fas fa-sync-alt"></i> Update Teachers | æ›´æ–°è€å¸«è³‡æ–™
                    </button>
                    <button class="btn btn-secondary" onclick="updateStudentStatus()">
                        <i class="fas fa-user-check"></i> Update Status | æ›´æ–°å­¸ç”Ÿç‹€æ…‹
                    </button>
                    <button class="btn btn-warning" onclick="debugSystem()">
                        <i class="fas fa-bug"></i> Debug | èª¿è©¦
                    </button>
                    <button class="btn btn-info" onclick="checkHeaders()">
                        <i class="fas fa-list"></i> Check Headers | æª¢æŸ¥æ¨™é¡Œ
                    </button>
                    <button class="btn btn-success" onclick="testCreation()">
                        <i class="fas fa-flask"></i> Test Creation | æ¸¬è©¦å»ºç«‹
                    </button>
                    <button class="btn btn-danger" onclick="systemBackup()">
                        <i class="fas fa-download"></i> Backup | å‚™ä»½
                    </button>
                </div>
            </div>

            <!-- Progress Overview Card -->
            <div class="card progress-overview">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div>
                        <div class="card-title">Progress Overview | é€²åº¦ç¸½è¦½</div>
                        <div class="bilingual">Teacher progress tracking</div>
                    </div>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ğŸŸ¢ Excellent (â‰¥90%) | å„ªç§€</span>
                    <span class="stat-value" id="progress-excellent">0 (0%)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ğŸŸ¡ Good (80-89%) | è‰¯å¥½</span>
                    <span class="stat-value" id="progress-good">0 (0%)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ğŸŸ  Normal (60-79%) | æ™®é€š</span>
                    <span class="stat-value" id="progress-normal">0 (0%)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ğŸ”´ Behind (<60%) | è½å¾Œ</span>
                    <span class="stat-value" id="progress-behind">0 (0%)</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="overall-progress" style="width: 75%;"></div>
                </div>
                <div style="text-align: center; margin-top: 10px;">
                    <small>Overall System Progress: <span id="overall-percentage">75%</span> | æ•´é«”ç³»çµ±é€²åº¦</small>
                </div>
            </div>
        </div>

        <!-- Quick Actions Section -->
        <div class="card">
            <div class="card-header">
                <div class="card-icon" style="background: #607D8B;">
                    <i class="fas fa-bolt"></i>
                </div>
                <div>
                    <div class="card-title">Quick Actions | å¿«é€Ÿæ“ä½œ</div>
                    <div class="bilingual">Frequently used system functions</div>
                </div>
            </div>
            <div class="control-grid">
                <button class="btn btn-primary" onclick="batchCreateGradebooks()">
                    <i class="fas fa-plus-circle"></i> Batch Create Gradebooks<br>
                    <small>æ‰¹é‡å»ºç«‹æˆç¸¾ç°¿</small>
                </button>
                <button class="btn btn-secondary" onclick="checkAllProgress()">
                    <i class="fas fa-chart-line"></i> Check All Progress<br>
                    <small>æª¢æŸ¥å…¨é«”é€²åº¦</small>
                </button>
                <button class="btn btn-warning" onclick="generateReport()">
                    <i class="fas fa-file-alt"></i> Generate Report<br>
                    <small>ç”Ÿæˆè©³ç´°å ±å‘Š</small>
                </button>
                <button class="btn btn-secondary" onclick="importStudentData()">
                    <i class="fas fa-upload"></i> Import Student Data<br>
                    <small>åŒ¯å…¥å­¸ç”Ÿè³‡æ–™</small>
                </button>
                <button class="btn btn-secondary" onclick="exportStudentData()">
                    <i class="fas fa-download"></i> Export Student Data<br>
                    <small>åŒ¯å‡ºå­¸ç”Ÿè³‡æ–™</small>
                </button>
                <button class="btn btn-warning" onclick="systemMaintenance()">
                    <i class="fas fa-tools"></i> System Maintenance<br>
                    <small>ç³»çµ±ç¶­è­·</small>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let isLoading = false;

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', function() {
            updateTimestamp();
            loadSystemStatistics();
            setInterval(updateTimestamp, 60000); // Update every minute
        });

        // Update timestamp
        function updateTimestamp() {
            const now = new Date();
            document.getElementById('last-updated').textContent = now.toLocaleString();
        }

        // Show loading indicator
        function showLoading() {
            if (isLoading) return;
            isLoading = true;
            document.getElementById('loading').style.display = 'block';
            hideAlerts();
        }

        // Hide loading indicator
        function hideLoading() {
            isLoading = false;
            document.getElementById('loading').style.display = 'none';
        }

        // Show success message
        function showSuccess(message) {
            const alert = document.getElementById('alert-success');
            alert.textContent = message;
            alert.style.display = 'block';
            setTimeout(() => alert.style.display = 'none', 5000);
        }

        // Show error message
        function showError(message) {
            const alert = document.getElementById('alert-error');
            alert.textContent = message;
            alert.style.display = 'block';
            setTimeout(() => alert.style.display = 'none', 5000);
        }

        // Hide all alerts
        function hideAlerts() {
            document.getElementById('alert-success').style.display = 'none';
            document.getElementById('alert-error').style.display = 'none';
        }

        // System Functions
        function initializeSystem() {
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    showSuccess('âœ… System initialized successfully! | ç³»çµ±åˆå§‹åŒ–æˆåŠŸï¼');
                    loadSystemStatistics();
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('âŒ Initialization failed: ' + error.message + ' | åˆå§‹åŒ–å¤±æ•—');
                })
                .initializeSystem();
        }

        function checkSystemStatus() {
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    showSuccess('ğŸŸ¢ System Status: Healthy | ç³»çµ±ç‹€æ…‹å¥åº·');
                    loadSystemStatistics();
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('âŒ Status check failed: ' + error.message + ' | ç‹€æ…‹æª¢æŸ¥å¤±æ•—');
                })
                .getSystemStatistics();
        }

        function refreshDashboard() {
            showLoading();
            loadSystemStatistics();
            setTimeout(() => {
                hideLoading();
                showSuccess('âœ… Dashboard refreshed successfully! | æ§åˆ¶å°é‡æ–°æ•´ç†æˆåŠŸï¼');
            }, 1000);
        }

        function loadSystemStatistics() {
            google.script.run
                .withSuccessHandler(function(stats) {
                    document.getElementById('total-teachers').textContent = stats.totalTeachers || 0;
                    document.getElementById('total-students').textContent = stats.totalStudents || 0;
                    document.getElementById('active-gradebooks').textContent = stats.activeGradebooks || 0;
                    document.getElementById('system-files').textContent = stats.systemFiles || 0;
                })
                .withFailureHandler(function(error) {
                    console.error('Failed to load statistics:', error);
                })
                .getSystemStatistics();
        }

        function openSystemFolder() {
            google.script.run
                .withSuccessHandler(function(url) {
                    window.open(url, '_blank');
                    showSuccess('ğŸ“ Opening system folder | æ­£åœ¨é–‹å•Ÿç³»çµ±è³‡æ–™å¤¾');
                })
                .withFailureHandler(function(error) {
                    showError('âŒ Cannot open system folder: ' + error.message + ' | ç„¡æ³•é–‹å•Ÿç³»çµ±è³‡æ–™å¤¾');
                })
                .getSystemFolderUrl();
        }

        function openMasterData() {
            google.script.run
                .withSuccessHandler(function(url) {
                    window.open(url, '_blank');
                    showSuccess('ğŸ“‹ Opening master data sheet | æ­£åœ¨é–‹å•Ÿä¸»æ§è³‡æ–™è¡¨');
                })
                .withFailureHandler(function(error) {
                    showError('âŒ Cannot open master data: ' + error.message + ' | ç„¡æ³•é–‹å•Ÿä¸»æ§è³‡æ–™è¡¨');
                })
                .getMasterDataUrl();
        }

        // Batch create gradebooks functionality
        function batchCreateGradebooks() {
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    showSuccess('ğŸ‰ Gradebook creation completed! | æˆç¸¾ç°¿å»ºç«‹å®Œæˆï¼');
                    loadSystemStatistics();
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('âŒ Failed to create gradebooks: ' + error.message + ' | å»ºç«‹æˆç¸¾ç°¿å¤±æ•—');
                })
                .batchCreateGradebooks();
        }

        function checkAllProgress() {
            showSuccess('ğŸ“ˆ Progress check feature coming soon! | é€²åº¦æª¢æŸ¥åŠŸèƒ½å³å°‡æ¨å‡ºï¼');
        }

        function generateReport() {
            showSuccess('ğŸ“‹ Report generation feature coming soon! | å ±å‘Šç”ŸæˆåŠŸèƒ½å³å°‡æ¨å‡ºï¼');
        }

        function importStudentData() {
            showSuccess('ğŸ“¥ Import feature coming soon! | åŒ¯å…¥åŠŸèƒ½å³å°‡æ¨å‡ºï¼');
        }

        function exportStudentData() {
            showSuccess('ğŸ“¤ Export feature coming soon! | åŒ¯å‡ºåŠŸèƒ½å³å°‡æ¨å‡ºï¼');
        }

        function systemBackup() {
            showSuccess('ğŸ”„ Backup feature coming soon! | å‚™ä»½åŠŸèƒ½å³å°‡æ¨å‡ºï¼');
        }

        function updateTeachers() {
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    showSuccess('âœ… Teachers updated successfully! Found ' + result.length + ' teachers | è€å¸«è³‡æ–™æ›´æ–°æˆåŠŸï¼æ‰¾åˆ° ' + result.length + ' ä½è€å¸«');
                    loadSystemStatistics();
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('âŒ Failed to update teachers: ' + error.message + ' | æ›´æ–°è€å¸«è³‡æ–™å¤±æ•—');
                })
                .updateAutoGeneratedTeachers();
        }

        function updateStudentStatus() {
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    showSuccess('âœ… Student status updated successfully! | å­¸ç”Ÿç‹€æ…‹æ›´æ–°æˆåŠŸï¼');
                    loadSystemStatistics();
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('âŒ Failed to update student status: ' + error.message + ' | æ›´æ–°å­¸ç”Ÿç‹€æ…‹å¤±æ•—');
                })
                .updateStudentStatus();
        }

        function debugSystem() {
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    let studentSamplesText = '';
                    if (result.studentSamples && result.studentSamples.length > 0) {
                        studentSamplesText = result.studentSamples.map(s => 
                            `â€¢ ${s.name || 'empty'} (Status: ${s.status || 'empty'}, Class: ${s.englishClass || 'empty'}, LT: ${s.ltTeacher || 'empty'}, IT: ${s.itTeacher || 'empty'})`
                        ).join('\n');
                    }
                    
                    let teacherSamplesText = '';
                    if (result.teacherSamples && result.teacherSamples.length > 0) {
                        teacherSamplesText = result.teacherSamples.map(t => 
                            `â€¢ ${t.name} (${t.subject}) - Classes: ${t.classes}`
                        ).join('\n');
                    }
                    
                    const debugInfo = `
ğŸ” System Debug Results | ç³»çµ±èª¿è©¦çµæœ:

ğŸ“ System Folder: ${result.systemFolder}
ğŸ“‹ Master Data Sheet: ${result.masterDataSheet}  
ğŸ‘¥ Students Data: ${result.studentsData} total records
ğŸ“ Students with "åœ¨å­¸" status: ${result.studentsWithStatus}
ğŸ‘¨â€ğŸ« Teachers Found: ${result.teachersFound}
ğŸ“Š Gradebooks Folder: ${result.teacherGradebooksFolder}

ğŸ“„ Student Samples (first 5):
${studentSamplesText || 'No student data found'}

ğŸ‘©â€ğŸ« Teacher Samples:
${teacherSamplesText || 'No teacher data found'}

${result.error ? 'âŒ Error: ' + result.error : 'âœ… No errors detected'}
                    `;
                    showSuccess(debugInfo);
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('âŒ Debug failed: ' + error.message + ' | èª¿è©¦å¤±æ•—');
                })
                .debugSystemStatus();
        }

        function checkHeaders() {
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    let headersText = '';
                    if (result.headers) {
                        headersText = result.headers.map((header, index) => 
                            `${index + 1}. "${header}"`
                        ).join('\n');
                    }
                    
                    let indicesText = '';
                    if (result.columnIndices) {
                        indicesText = Object.entries(result.columnIndices).map(([col, index]) => 
                            `"${col}": ${index === -1 ? 'NOT FOUND' : 'Column ' + (index + 1)}`
                        ).join('\n');
                    }
                    
                    let sampleRowText = '';
                    if (result.sampleRow) {
                        sampleRowText = result.sampleRow.map((value, index) => 
                            `${index + 1}. ${value || 'empty'}`
                        ).join('\n');
                    }
                    
                    const headerInfo = `
ğŸ“‹ Column Headers Check | æ¬„ä½æ¨™é¡Œæª¢æŸ¥:

ğŸ“Š Total Columns: ${result.columnCount}
ğŸ“„ Data Rows: ${result.dataRows}

ğŸ” All Headers:
${headersText}

ğŸ¯ Key Column Indices:
${indicesText}

ğŸ“ Sample Row Data:
${sampleRowText}

${result.error ? 'âŒ Error: ' + result.error : 'âœ… Headers checked successfully'}
                    `;
                    showSuccess(headerInfo);
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('âŒ Header check failed: ' + error.message + ' | æ¨™é¡Œæª¢æŸ¥å¤±æ•—');
                })
                .checkColumnHeaders();
        }

        function testCreation() {
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result.error) {
                        showError('âŒ Test failed: ' + result.error);
                        return;
                    }
                    
                    let assignmentText = '';
                    if (result && result.length > 0) {
                        assignmentText = result.map(assignment => 
                            `ğŸ« ${assignment.teacher} (${assignment.subject})
   ğŸ“š Class: ${assignment.class}
   ğŸ‘¥ Students (${assignment.studentCount}): ${assignment.studentNames.join(', ')}`
                        ).join('\n\n');
                    }
                    
                    const testInfo = `
ğŸ§ª Gradebook Creation Test | æˆç¸¾ç°¿å»ºç«‹æ¸¬è©¦:

${assignmentText || 'No valid assignments found | æ‰¾ä¸åˆ°æœ‰æ•ˆçš„åˆ†é…'}

${result.length === 0 ? 'âš ï¸ No students were assigned to any teachers!' : 'âœ… Student assignments look correct!'}
                    `;
                    showSuccess(testInfo);
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('âŒ Test failed: ' + error.message + ' | æ¸¬è©¦å¤±æ•—');
                })
                .testGradebookCreation();
        }

        function systemMaintenance() {
            showSuccess('ğŸ”§ Maintenance feature coming soon! | ç¶­è­·åŠŸèƒ½å³å°‡æ¨å‡ºï¼');
        }
    </script>
</body>
</html>