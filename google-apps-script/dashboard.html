<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gradebook System Dashboard | ÊàêÁ∏æÁ∞øÁ≥ªÁµ±ÊéßÂà∂Âè∞</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-icon {
            font-size: 2rem;
            margin-right: 15px;
            padding: 15px;
            border-radius: 10px;
            color: white;
        }

        .system-status .card-icon { background: #4CAF50; }
        .quick-stats .card-icon { background: #2196F3; }
        .system-controls .card-icon { background: #FF9800; }
        .progress-overview .card-icon { background: #9C27B0; }

        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #333;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-weight: 500;
            color: #666;
        }

        .stat-value {
            font-weight: 600;
            color: #333;
            padding: 5px 10px;
            background: #f5f5f5;
            border-radius: 5px;
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #2196F3;
            color: white;
        }

        .btn-secondary:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #FF9800;
            color: white;
        }

        .btn-warning:hover {
            background: #F57C00;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
            transform: translateY(-2px);
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        /* Assessment Title Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 3% auto;
            padding: 0;
            border: none;
            border-radius: 15px;
            width: 90%;
            max-width: 1000px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 25px 30px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.8rem;
        }

        .modal-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .class-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .class-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .class-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .class-info h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 1.3rem;
        }

        .class-info p {
            margin: 5px 0 0 0;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .assessment-section {
            margin-bottom: 20px;
        }

        .assessment-section h4 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 1.1rem;
        }

        .assessment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
        }

        .assessment-input {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        .assessment-input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .btn-update {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .btn-update:hover {
            background: #0056b3;
        }

        .btn-reset {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-left: 10px;
            transition: background 0.3s ease;
        }

        .btn-reset:hover {
            background: #c82333;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            padding: 0 10px;
            transition: opacity 0.3s ease;
        }

        .close:hover {
            opacity: 0.7;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-excellent { background: #4CAF50; }
        .status-good { background: #FFC107; }
        .status-warning { background: #FF9800; }
        .status-error { background: #f44336; }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #eee;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .alert {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .bilingual {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        /* Assessment Title Manager Styles */
        .assessment-form {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .form-section {
            margin-bottom: 20px;
        }
        
        .form-section label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 8px;
        }
        
        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: normal !important;
        }
        
        .radio-label input[type="radio"] {
            margin-right: 8px;
            transform: scale(1.2);
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 30px;
        }
        
        .result-section {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .result-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .result-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Progress Audit Modal Styles */
        .tab-container {
            margin-top: 20px;
        }
        
        .tab-buttons {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background: #f8f9fa;
            border: none;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
            font-weight: 500;
            color: #495057;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            background: #007bff;
            color: white;
        }
        
        .tab-btn:hover:not(.active) {
            background: #e9ecef;
        }
        
        .tab-content {
            padding: 20px;
            border: 1px solid #e9ecef;
            border-radius: 0 5px 5px 5px;
            min-height: 200px;
        }
        
        .level-groups {
            display: grid;
            gap: 20px;
        }
        
        .level-group {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .level-group h4 {
            margin: 0 0 15px 0;
            color: #007bff;
            font-size: 1.2em;
        }
        
        .assessment-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .assessment-type {
            background: white;
            padding: 12px;
            border-radius: 5px;
        }
        
        .assessment-type strong {
            display: block;
            margin-bottom: 10px;
            color: #495057;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }
        
        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }
        
        .checkbox-group input[type="checkbox"] {
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .control-grid {
                grid-template-columns: 1fr;
            }
            
            .assessment-form {
                max-width: 100%;
            }
            
            .radio-group {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        /* Progress Audit Loading Indicator */
        .loading-indicator {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .loading-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: #6c757d;
        }
        
        .loading-content i {
            font-size: 1.2rem;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Progress Audit Messages */
        .progress-audit-message {
            padding: 12px 16px;
            margin: 15px 0;
            border-radius: 6px;
            font-weight: 500;
        }
        
        .progress-audit-message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .progress-audit-message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Progress Results Display */
        .progress-results {
            margin: 20px 0;
            padding: 15px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }
        
        .progress-audit-summary {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .progress-audit-summary h4 {
            margin: 0 0 15px 0;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 8px;
        }
        
        .audit-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .audit-meta p {
            margin: 5px 0;
            color: #6c757d;
        }
        
        .progress-results-table {
            overflow-x: auto;
        }
        
        .progress-results table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .progress-results th,
        .progress-results td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        
        .progress-results th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }
        
        .progress-results tr:hover {
            background-color: #f8f9fa;
        }
        
        .level-group-breakdown {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
        }
        
        .level-group-breakdown h5 {
            color: #495057;
            margin-bottom: 15px;
        }
        
        .level-group-item {
            background: #f8f9fa;
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        
        .level-group-item h6 {
            margin: 0 0 5px 0;
            font-weight: 600;
            color: #495057;
        }
        
        .level-group-item p {
            margin: 0;
            color: #6c757d;
            font-size: 0.9rem;
        }

        /* Dashboard Navigation Styles */
        .dashboard-navigation {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 12px 24px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: #007bff;
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
        }

        /* Comparison Dashboard Styles */
        .comparison-dashboard {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .comparison-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }

        .comparison-header h2 {
            color: #495057;
            margin-bottom: 10px;
        }

        .comparison-header p {
            color: #6c757d;
            font-size: 16px;
        }

        .comparison-controls {
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .control-group label {
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .control-group select {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            background: white;
        }

        /* Summary Statistics Styles */
        .comparison-summary {
            margin-bottom: 30px;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
        }

        .comparison-summary h3 {
            color: #1976d2;
            margin-bottom: 15px;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-label {
            font-weight: 600;
            color: #495057;
        }

        .stat-value {
            font-weight: bold;
            color: #2196f3;
            font-size: 16px;
        }

        /* Comparison Table Styles */
        .comparison-table-container {
            margin-top: 30px;
        }

        .comparison-table-container h3 {
            color: #495057;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .table-wrapper {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-size: 14px;
        }

        .comparison-table thead {
            background: #f8f9fa;
        }

        .comparison-table th {
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            border-right: 1px solid #dee2e6;
        }

        .comparison-table th:last-child {
            border-right: none;
        }

        .comparison-table td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
            border-right: 1px solid #dee2e6;
        }

        .comparison-table td:last-child {
            border-right: none;
        }

        .comparison-table tbody tr:hover {
            background: #f8f9fa;
        }

        /* Status indicators */
        .status-excellent { color: #28a745; font-weight: bold; }
        .status-good { color: #ffc107; font-weight: bold; }
        .status-normal { color: #fd7e14; font-weight: bold; }
        .status-behind { color: #dc3545; font-weight: bold; }

        /* Grade level tags */
        .grade-level-tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }

        .grade-level-tag.g1 { background: #e91e63; }
        .grade-level-tag.g2 { background: #9c27b0; }
        .grade-level-tag.g3 { background: #673ab7; }
        .grade-level-tag.g4 { background: #3f51b5; }
        .grade-level-tag.g5 { background: #2196f3; }
        .grade-level-tag.g6 { background: #009688; }

        /* Responsive Design */
        @media (max-width: 768px) {
            .comparison-controls {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-buttons {
                justify-content: stretch;
            }
            
            .nav-btn {
                flex: 1;
                justify-content: center;
            }
            
            .summary-stats {
                grid-template-columns: 1fr;
            }
            
            .comparison-table {
                font-size: 12px;
            }
            
            .comparison-table th,
            .comparison-table td {
                padding: 8px 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üìä Gradebook System Dashboard</h1>
            <p>Educational grade management system</p>
            <div class="bilingual">Complete Google-based gradebook solution</div>
        </div>

        <!-- Alert Messages -->
        <div id="alert-success" class="alert alert-success"></div>
        <div id="alert-error" class="alert alert-error"></div>

        <!-- Loading Indicator -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Processing...</p>
        </div>

        <!-- Dashboard Navigation -->
        <div class="dashboard-navigation">
            <div class="nav-buttons">
                <button id="btn-main-dashboard" class="nav-btn active" onclick="switchToDashboard('main')">
                    <i class="fas fa-tachometer-alt"></i> Main Dashboard | ‰∏ªÊéßÈù¢Êùø
                </button>
                <button id="btn-comparison-dashboard" class="nav-btn" onclick="switchToDashboard('comparison')">
                    <i class="fas fa-chart-bar"></i> Comparison Dashboard | ÊØîËºÉÈù¢Êùø
                </button>
            </div>
        </div>

        <!-- Comparison Dashboard Section -->
        <div id="comparison-dashboard" class="comparison-dashboard" style="display: none;">
            <div class="comparison-header">
                <h2><i class="fas fa-chart-bar"></i> Class Performance Comparison | Áè≠Á¥öË°®ÁèæÊØîËºÉ</h2>
                <p class="bilingual">Compare grade statistics and progress across all classes | ÊØîËºÉÊâÄÊúâÁè≠Á¥öÁöÑÊàêÁ∏æÁµ±Ë®àËàáÈÄ≤Â∫¶</p>
            </div>
            
            <!-- Comparison Controls -->
            <div class="comparison-controls">
                <div class="control-group">
                    <label for="grade-level-filter">Grade Level Filter | Âπ¥Á¥öÁØ©ÈÅ∏:</label>
                    <select id="grade-level-filter" onchange="filterByGradeLevel()">
                        <option value="all">All Grades | ÊâÄÊúâÂπ¥Á¥ö</option>
                        <option value="G1">Grade 1 | ‰∏ÄÂπ¥Á¥ö</option>
                        <option value="G2">Grade 2 | ‰∫åÂπ¥Á¥ö</option>
                        <option value="G3">Grade 3 | ‰∏âÂπ¥Á¥ö</option>
                        <option value="G4">Grade 4 | ÂõõÂπ¥Á¥ö</option>
                        <option value="G5">Grade 5 | ‰∫îÂπ¥Á¥ö</option>
                        <option value="G6">Grade 6 | ÂÖ≠Âπ¥Á¥ö</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="sort-method">Sort By | ÊéíÂ∫èÊñπÂºè:</label>
                    <select id="sort-method" onchange="sortComparisonData()">
                        <option value="class-name">Class Name | Áè≠Á¥öÂêçÁ®±</option>
                        <option value="term-grade">Term Grade | Â≠∏ÊúüÊàêÁ∏æ</option>
                        <option value="formative">Formative Average | ÂΩ¢ÊàêÊÄßË©ïÈáè</option>
                        <option value="summative">Summative Average | Á∏ΩÁµêÊÄßË©ïÈáè</option>
                        <option value="student-count">Student Count | Â≠∏Áîü‰∫∫Êï∏</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" onclick="loadComparisonData()">
                    <i class="fas fa-sync-alt"></i> Refresh Data | ÈáçÊñ∞Êï¥ÁêÜË≥áÊñô
                </button>
            </div>
            
            <!-- Comparison Results Loading -->
            <div id="comparison-loading" class="loading-indicator" style="display: none;">
                <div class="loading-content">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>Loading comparison data... | Ê≠£Âú®ËºâÂÖ•ÊØîËºÉË≥áÊñô...</span>
                </div>
            </div>
            
            <!-- Comparison Results Display -->
            <div id="comparison-results" class="comparison-results" style="display: none;">
                <!-- Summary Statistics -->
                <div class="comparison-summary">
                    <h3><i class="fas fa-chart-pie"></i> Summary Statistics | Áµ±Ë®àÊëòË¶Å</h3>
                    <div class="summary-stats">
                        <div class="stat-item">
                            <span class="stat-label">Total Classes | Á∏ΩÁè≠Á¥öÊï∏:</span>
                            <span id="total-classes" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Total Students | Á∏ΩÂ≠∏ÁîüÊï∏:</span>
                            <span id="total-students" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Average Class Size | Âπ≥ÂùáÁè≠Á¥ö‰∫∫Êï∏:</span>
                            <span id="avg-class-size" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">System Average | Á≥ªÁµ±Âπ≥Âùá:</span>
                            <span id="system-average" class="stat-value">0%</span>
                        </div>
                    </div>
                </div>
                
                <!-- Class Comparison Table -->
                <div class="comparison-table-container">
                    <h3><i class="fas fa-table"></i> Detailed Class Comparison | Áè≠Á¥öË©≥Á¥∞ÊØîËºÉ</h3>
                    <div class="table-wrapper">
                        <table id="comparison-table" class="comparison-table">
                            <thead>
                                <tr>
                                    <th>Class | Áè≠Á¥ö</th>
                                    <th>Grade Level | Âπ¥Á¥ö</th>
                                    <th>Students | Â≠∏ÁîüÊï∏</th>
                                    <th>Term Grade | Â≠∏ÊúüÊàêÁ∏æ</th>
                                    <th>Formative | ÂΩ¢ÊàêÊÄß</th>
                                    <th>Summative | Á∏ΩÁµêÊÄß</th>
                                    <th>Final | ÊúüÊú´</th>
                                    <th>Status | ÁãÄÊÖã</th>
                                </tr>
                            </thead>
                            <tbody id="comparison-table-body">
                                <!-- Data will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- System Status Card -->
            <div class="card system-status">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-heartbeat"></i>
                    </div>
                    <div>
                        <div class="card-title">System Status</div>
                        <div class="bilingual">Real-time system health monitoring</div>
                    </div>
                </div>
                <div class="stat-item">
                    <span class="stat-label">System Health</span>
                    <span class="stat-value">
                        <span class="status-indicator status-excellent"></span>
                        Excellent
                    </span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Last Updated</span>
                    <span class="stat-value" id="last-updated">Loading...</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Semester</span>
                    <span class="stat-value">2526F1</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Version</span>
                    <span class="stat-value">Dashboard v3.0</span>
                </div>
            </div>

            <!-- Quick Statistics Card -->
            <div class="card quick-stats">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div>
                        <div class="card-title">Quick Statistics</div>
                        <div class="bilingual">Real-time system metrics</div>
                    </div>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Total Teachers</span>
                    <span class="stat-value" id="total-teachers">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Total Students</span>
                    <span class="stat-value" id="total-students">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Active Gradebooks</span>
                    <span class="stat-value" id="active-gradebooks">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">System Files</span>
                    <span class="stat-value" id="system-files">0</span>
                </div>
            </div>

            <!-- System Controls Card -->
            <div class="card system-controls">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <div>
                        <div class="card-title">System Controls</div>
                        <div class="bilingual">One-click system management</div>
                    </div>
                </div>
                <div class="control-grid">
                    <button class="btn btn-primary" onclick="initializeSystem()">
                        <i class="fas fa-rocket"></i> Initialize System
                    </button>
                    <button class="btn btn-secondary" onclick="checkSystemStatus()">
                        <i class="fas fa-stethoscope"></i> Check Status
                    </button>
                    <button class="btn btn-warning" onclick="refreshDashboard()">
                        <i class="fas fa-sync-alt"></i> Refresh Dashboard
                    </button>
                    <button class="btn btn-secondary" onclick="openSystemFolder()">
                        <i class="fas fa-folder-open"></i> System Folder
                    </button>
                    <button class="btn btn-info" onclick="openMasterData()">
                        <i class="fas fa-database"></i> Master Data
                    </button>
                    <button class="btn btn-success" onclick="manageAssessmentTitles()">
                        <i class="fas fa-tags"></i> Assessment Titles
                    </button>
                    <button class="btn btn-danger" onclick="systemBackup()">
                        <i class="fas fa-download"></i> System Backup
                    </button>
                    <button class="btn btn-info" onclick="testSystemIntegrity()">
                        <i class="fas fa-check-circle"></i> Test System
                    </button>
                    <button class="btn btn-warning" onclick="performQualityCheck()">
                        <i class="fas fa-search"></i> /check Quality
                    </button>
                    <button class="btn btn-success" onclick="openResourceManager()">
                        <i class="fas fa-plus-circle"></i> Add Resource
                    </button>
                    <button class="btn btn-primary" onclick="openHTDashboard()">
                        <i class="fas fa-user-tie"></i> HT Dashboard
                    </button>
                    <button class="btn btn-warning" onclick="openProgressAudit()">
                        <i class="fas fa-clipboard-check"></i> Progress Audit | ÈÄ≤Â∫¶Á®ΩÊ†∏
                    </button>
                    <button class="btn btn-info" onclick="runComparisonDashboardDiagnosis()">
                        <i class="fas fa-bug"></i> Diagnose Comparison Dashboard | Ë®∫Êñ∑ÊØîËºÉÈù¢Êùø
                    </button>
                    <button class="btn btn-warning" onclick="debugAverageRowDetection()">
                        <i class="fas fa-microscope"></i> Debug Average Row Detection | Ë™øË©¶Âπ≥ÂùáË°åÊ™¢Ê∏¨
                    </button>
                    <button class="btn btn-danger" onclick="debugAverageRowDataExtraction()">
                        <i class="fas fa-chart-line"></i> Debug Data Extraction | Ë™øË©¶Êï∏ÊìöÊèêÂèñ
                    </button>
                    <button class="btn btn-info" onclick="debugColumnPositions()">
                        <i class="fas fa-table"></i> Debug Column Positions | Ë™øË©¶Âàó‰ΩçÁΩÆ
                    </button>
                </div>
            </div>

            <!-- Progress Overview Card -->
            <div class="card progress-overview">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div>
                        <div class="card-title">Progress Overview</div>
                        <div class="bilingual">Teacher progress tracking</div>
                    </div>
                </div>
                <div class="stat-item">
                    <span class="stat-label">üü¢ Excellent (‚â•90%)</span>
                    <span class="stat-value" id="progress-excellent">0 (0%)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">üü° Good (80-89%)</span>
                    <span class="stat-value" id="progress-good">0 (0%)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">üü† Normal (60-79%)</span>
                    <span class="stat-value" id="progress-normal">0 (0%)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">üî¥ Behind (<60%)</span>
                    <span class="stat-value" id="progress-behind">0 (0%)</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="overall-progress" style="width: 75%;"></div>
                </div>
                <div style="text-align: center; margin-top: 10px;">
                    <small>Overall System Progress: <span id="overall-percentage">75%</span></small>
                </div>
            </div>
        </div>

        <!-- Quick Actions Section -->
        <div class="card">
            <div class="card-header">
                <div class="card-icon" style="background: #607D8B;">
                    <i class="fas fa-bolt"></i>
                </div>
                <div>
                    <div class="card-title">Quick Actions</div>
                    <div class="bilingual">Frequently used system functions</div>
                </div>
            </div>
            <div class="control-grid">
                <button class="btn btn-primary" onclick="batchCreateGradebooks()">
                    <i class="fas fa-plus-circle"></i> Batch Create Gradebooks
                </button>
                <button class="btn btn-warning" onclick="quickProgressCheck()">
                    <i class="fas fa-tachometer-alt"></i> Quick Progress Check
                </button>
                <button class="btn btn-info" onclick="openProgressStandardsDialog()">
                    <i class="fas fa-cogs"></i> Custom Progress Check
                </button>
                <button class="btn btn-warning" onclick="generateReport()">
                    <i class="fas fa-file-alt"></i> Generate Report
                </button>
                <button class="btn btn-secondary" onclick="importStudentData()">
                    <i class="fas fa-upload"></i> Import Student Data
                </button>
                <button class="btn btn-secondary" onclick="exportStudentData()">
                    <i class="fas fa-download"></i> Export Student Data
                </button>
                <button class="btn btn-warning" onclick="systemMaintenance()">
                    <i class="fas fa-tools"></i> System Maintenance
                </button>
                <button class="btn btn-success" onclick="openAssessmentTitleManager()">
                    <i class="fas fa-edit"></i> Assessment Title Manager
                </button>
            </div>
        </div>
    </div>

    <!-- Assessment Title Management Modal -->
    <div id="assessmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-tags"></i> Assessment Title Management</h2>
                <span class="close" onclick="closeAssessmentModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="assessment-content">
                    <div class="assessment-form">
                        <div class="form-section">
                            <label for="classSelect"><i class="fas fa-school"></i> Class | Áè≠Á¥ö:</label>
                            <select id="classSelect" class="form-control">
                                <option value="">Select Class | ÈÅ∏ÊìáÁè≠Á¥ö</option>
                                <option value="G1E1">G1E1</option>
                                <option value="G1E2">G1E2</option>
                                <option value="G1E3">G1E3</option>
                                <option value="G2E1">G2E1</option>
                                <option value="G2E2">G2E2</option>
                                <option value="G2E3">G2E3</option>
                                <option value="G3E1">G3E1</option>
                                <option value="G3E2">G3E2</option>
                                <option value="G3E3">G3E3</option>
                                <option value="G4E1">G4E1</option>
                                <option value="G4E2">G4E2</option>
                                <option value="G4E3">G4E3</option>
                                <option value="G5E1">G5E1</option>
                                <option value="G5E2">G5E2</option>
                                <option value="G5E3">G5E3</option>
                                <option value="G6E1">G6E1</option>
                                <option value="G6E2">G6E2</option>
                                <option value="G6E3">G6E3</option>
                            </select>
                        </div>
                        
                        <div class="form-section">
                            <label><i class="fas fa-book"></i> Subject | ÁßëÁõÆ:</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="subject" value="LT"> LT (Language Teacher)
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="subject" value="IT"> IT (International Teacher)
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <label for="assessmentSelect"><i class="fas fa-clipboard-check"></i> Assessment | Ë©ïÈáè:</label>
                            <select id="assessmentSelect" class="form-control">
                                <option value="">Select Assessment | ÈÅ∏ÊìáË©ïÈáè</option>
                                <optgroup label="Formative Assessments | ÂΩ¢ÊàêÊÄßË©ïÈáè">
                                    <option value="F.A.1">F.A.1</option>
                                    <option value="F.A.2">F.A.2</option>
                                    <option value="F.A.3">F.A.3</option>
                                    <option value="F.A.4">F.A.4</option>
                                    <option value="F.A.5">F.A.5</option>
                                    <option value="F.A.6">F.A.6</option>
                                    <option value="F.A.7">F.A.7</option>
                                    <option value="F.A.8">F.A.8</option>
                                </optgroup>
                                <optgroup label="Summative Assessments | Á∏ΩÁµêÊÄßË©ïÈáè">
                                    <option value="S.A.1">S.A.1</option>
                                    <option value="S.A.2">S.A.2</option>
                                    <option value="S.A.3">S.A.3</option>
                                    <option value="S.A.4">S.A.4</option>
                                </optgroup>
                                <optgroup label="Other Assessments | ÂÖ∂‰ªñË©ïÈáè">
                                    <option value="Midterm">Midterm | Êúü‰∏≠ËÄÉ</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <div class="form-section">
                            <label for="newTitle"><i class="fas fa-edit"></i> New Title | Êñ∞Ê®ôÈ°å:</label>
                            <input type="text" id="newTitle" class="form-control" placeholder="Enter new assessment title | Ëº∏ÂÖ•Êñ∞ÁöÑË©ïÈáèÊ®ôÈ°å">
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="updateAssessmentTitle()">
                                <i class="fas fa-save"></i> Update Title | Êõ¥Êñ∞Ê®ôÈ°å
                            </button>
                            <button class="btn btn-secondary" onclick="closeAssessmentModal()">
                                <i class="fas fa-times"></i> Cancel | ÂèñÊ∂à
                            </button>
                        </div>
                        
                        <div id="assessment-result" class="result-section" style="display: none;">
                            <!-- Results will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Audit Modal -->
    <div id="progressAuditModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2><i class="fas fa-clipboard-check"></i> Progress Audit Configuration | ÈÄ≤Â∫¶Á®ΩÊ†∏Ë®≠ÂÆö</h2>
                <span class="close" onclick="closeProgressAuditModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="progress-audit-content">
                    <div class="progress-audit-form">
                        <!-- Checkpoint Info -->
                        <div class="form-section">
                            <label for="checkpointName"><i class="fas fa-bookmark"></i> Checkpoint Name | Ê™¢Êü•ÈªûÂêçÁ®±:</label>
                            <input type="text" id="checkpointName" class="form-control" 
                                   placeholder="e.g., Mid-Term Progress Check | Êúü‰∏≠ÈÄ≤Â∫¶Ê™¢Êü•">
                        </div>
                        
                        <!-- Grade Level Tabs -->
                        <div class="tab-container">
                            <div class="tab-buttons">
                                <button class="tab-btn active" onclick="switchProgressTab('G1')">G1</button>
                                <button class="tab-btn" onclick="switchProgressTab('G2')">G2</button>
                                <button class="tab-btn" onclick="switchProgressTab('G3')">G3</button>
                                <button class="tab-btn" onclick="switchProgressTab('G4')">G4</button>
                                <button class="tab-btn" onclick="switchProgressTab('G5')">G5</button>
                                <button class="tab-btn" onclick="switchProgressTab('G6')">G6</button>
                            </div>
                            
                            <!-- Grade Level Content -->
                            <div id="G1-tab" class="tab-content active">
                                <div class="level-groups">
                                    <div class="level-group">
                                        <h4>G1E1</h4>
                                        <div class="assessment-selection">
                                            <div class="assessment-type">
                                                <strong>Formative (F.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="fa-G1E1-1" name="G1E1-FA" value="F.A.1" class="progress-checkbox"> F.A.1</label>
                                                    <label><input type="checkbox" id="fa-G1E1-2" name="G1E1-FA" value="F.A.2" class="progress-checkbox"> F.A.2</label>
                                                    <label><input type="checkbox" id="fa-G1E1-3" name="G1E1-FA" value="F.A.3" class="progress-checkbox"> F.A.3</label>
                                                    <label><input type="checkbox" id="fa-G1E1-4" name="G1E1-FA" value="F.A.4" class="progress-checkbox"> F.A.4</label>
                                                    <label><input type="checkbox" id="fa-G1E1-5" name="G1E1-FA" value="F.A.5" class="progress-checkbox"> F.A.5</label>
                                                    <label><input type="checkbox" id="fa-G1E1-6" name="G1E1-FA" value="F.A.6" class="progress-checkbox"> F.A.6</label>
                                                    <label><input type="checkbox" id="fa-G1E1-7" name="G1E1-FA" value="F.A.7" class="progress-checkbox"> F.A.7</label>
                                                    <label><input type="checkbox" id="fa-G1E1-8" name="G1E1-FA" value="F.A.8" class="progress-checkbox"> F.A.8</label>
                                                </div>
                                            </div>
                                            <div class="assessment-type">
                                                <strong>Summative (S.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="sa-G1E1-1" name="G1E1-SA" value="S.A.1" class="progress-checkbox"> S.A.1</label>
                                                    <label><input type="checkbox" id="sa-G1E1-2" name="G1E1-SA" value="S.A.2" class="progress-checkbox"> S.A.2</label>
                                                    <label><input type="checkbox" id="sa-G1E1-3" name="G1E1-SA" value="S.A.3" class="progress-checkbox"> S.A.3</label>
                                                    <label><input type="checkbox" id="sa-G1E1-4" name="G1E1-SA" value="S.A.4" class="progress-checkbox"> S.A.4</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="level-group">
                                        <h4>G1E2</h4>
                                        <div class="assessment-selection">
                                            <div class="assessment-type">
                                                <strong>Formative (F.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="fa-G1E2-1" name="G1E2-FA" value="F.A.1" class="progress-checkbox"> F.A.1</label>
                                                    <label><input type="checkbox" id="fa-G1E2-2" name="G1E2-FA" value="F.A.2" class="progress-checkbox"> F.A.2</label>
                                                    <label><input type="checkbox" id="fa-G1E2-3" name="G1E2-FA" value="F.A.3" class="progress-checkbox"> F.A.3</label>
                                                    <label><input type="checkbox" id="fa-G1E2-4" name="G1E2-FA" value="F.A.4" class="progress-checkbox"> F.A.4</label>
                                                    <label><input type="checkbox" id="fa-G1E2-5" name="G1E2-FA" value="F.A.5" class="progress-checkbox"> F.A.5</label>
                                                    <label><input type="checkbox" id="fa-G1E2-6" name="G1E2-FA" value="F.A.6" class="progress-checkbox"> F.A.6</label>
                                                    <label><input type="checkbox" id="fa-G1E2-7" name="G1E2-FA" value="F.A.7" class="progress-checkbox"> F.A.7</label>
                                                    <label><input type="checkbox" id="fa-G1E2-8" name="G1E2-FA" value="F.A.8" class="progress-checkbox"> F.A.8</label>
                                                </div>
                                            </div>
                                            <div class="assessment-type">
                                                <strong>Summative (S.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="sa-G1E2-1" name="G1E2-SA" value="S.A.1" class="progress-checkbox"> S.A.1</label>
                                                    <label><input type="checkbox" id="sa-G1E2-2" name="G1E2-SA" value="S.A.2" class="progress-checkbox"> S.A.2</label>
                                                    <label><input type="checkbox" id="sa-G1E2-3" name="G1E2-SA" value="S.A.3" class="progress-checkbox"> S.A.3</label>
                                                    <label><input type="checkbox" id="sa-G1E2-4" name="G1E2-SA" value="S.A.4" class="progress-checkbox"> S.A.4</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="level-group">
                                        <h4>G1E3</h4>
                                        <div class="assessment-selection">
                                            <div class="assessment-type">
                                                <strong>Formative (F.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="fa-G1E3-1" name="G1E3-FA" value="F.A.1" class="progress-checkbox"> F.A.1</label>
                                                    <label><input type="checkbox" id="fa-G1E3-2" name="G1E3-FA" value="F.A.2" class="progress-checkbox"> F.A.2</label>
                                                    <label><input type="checkbox" id="fa-G1E3-3" name="G1E3-FA" value="F.A.3" class="progress-checkbox"> F.A.3</label>
                                                    <label><input type="checkbox" id="fa-G1E3-4" name="G1E3-FA" value="F.A.4" class="progress-checkbox"> F.A.4</label>
                                                    <label><input type="checkbox" id="fa-G1E3-5" name="G1E3-FA" value="F.A.5" class="progress-checkbox"> F.A.5</label>
                                                    <label><input type="checkbox" id="fa-G1E3-6" name="G1E3-FA" value="F.A.6" class="progress-checkbox"> F.A.6</label>
                                                    <label><input type="checkbox" id="fa-G1E3-7" name="G1E3-FA" value="F.A.7" class="progress-checkbox"> F.A.7</label>
                                                    <label><input type="checkbox" id="fa-G1E3-8" name="G1E3-FA" value="F.A.8" class="progress-checkbox"> F.A.8</label>
                                                </div>
                                            </div>
                                            <div class="assessment-type">
                                                <strong>Summative (S.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="sa-G1E3-1" name="G1E3-SA" value="S.A.1" class="progress-checkbox"> S.A.1</label>
                                                    <label><input type="checkbox" id="sa-G1E3-2" name="G1E3-SA" value="S.A.2" class="progress-checkbox"> S.A.2</label>
                                                    <label><input type="checkbox" id="sa-G1E3-3" name="G1E3-SA" value="S.A.3" class="progress-checkbox"> S.A.3</label>
                                                    <label><input type="checkbox" id="sa-G1E3-4" name="G1E3-SA" value="S.A.4" class="progress-checkbox"> S.A.4</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- G2-G6 Tab Content (Full Implementation) -->
                            <!-- Due to length constraints, implementing simplified version for now -->
                            <!-- Each grade follows the same pattern as G1 with G2E1-G2E3, G3E1-G3E3, etc. -->
                            <div id="G2-tab" class="tab-content" style="display:none;">
                                <div class="level-groups">
                                    <div class="level-group">
                                        <h4>G2E1</h4>
                                        <div class="assessment-selection">
                                            <div class="assessment-type">
                                                <strong>Formative (F.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="fa-G2E1-1" name="G2E1-FA" value="F.A.1" class="progress-checkbox"> F.A.1</label>
                                                    <label><input type="checkbox" id="fa-G2E1-2" name="G2E1-FA" value="F.A.2" class="progress-checkbox"> F.A.2</label>
                                                    <label><input type="checkbox" id="fa-G2E1-3" name="G2E1-FA" value="F.A.3" class="progress-checkbox"> F.A.3</label>
                                                    <label><input type="checkbox" id="fa-G2E1-4" name="G2E1-FA" value="F.A.4" class="progress-checkbox"> F.A.4</label>
                                                    <label><input type="checkbox" id="fa-G2E1-5" name="G2E1-FA" value="F.A.5" class="progress-checkbox"> F.A.5</label>
                                                    <label><input type="checkbox" id="fa-G2E1-6" name="G2E1-FA" value="F.A.6" class="progress-checkbox"> F.A.6</label>
                                                    <label><input type="checkbox" id="fa-G2E1-7" name="G2E1-FA" value="F.A.7" class="progress-checkbox"> F.A.7</label>
                                                    <label><input type="checkbox" id="fa-G2E1-8" name="G2E1-FA" value="F.A.8" class="progress-checkbox"> F.A.8</label>
                                                </div>
                                            </div>
                                            <div class="assessment-type">
                                                <strong>Summative (S.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="sa-G2E1-1" name="G2E1-SA" value="S.A.1" class="progress-checkbox"> S.A.1</label>
                                                    <label><input type="checkbox" id="sa-G2E1-2" name="G2E1-SA" value="S.A.2" class="progress-checkbox"> S.A.2</label>
                                                    <label><input type="checkbox" id="sa-G2E1-3" name="G2E1-SA" value="S.A.3" class="progress-checkbox"> S.A.3</label>
                                                    <label><input type="checkbox" id="sa-G2E1-4" name="G2E1-SA" value="S.A.4" class="progress-checkbox"> S.A.4</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="level-group">
                                        <h4>G2E2</h4>
                                        <div class="assessment-selection">
                                            <div class="assessment-type">
                                                <strong>Formative (F.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="fa-G2E2-1" name="G2E2-FA" value="F.A.1" class="progress-checkbox"> F.A.1</label>
                                                    <label><input type="checkbox" id="fa-G2E2-2" name="G2E2-FA" value="F.A.2" class="progress-checkbox"> F.A.2</label>
                                                    <label><input type="checkbox" id="fa-G2E2-3" name="G2E2-FA" value="F.A.3" class="progress-checkbox"> F.A.3</label>
                                                    <label><input type="checkbox" id="fa-G2E2-4" name="G2E2-FA" value="F.A.4" class="progress-checkbox"> F.A.4</label>
                                                    <label><input type="checkbox" id="fa-G2E2-5" name="G2E2-FA" value="F.A.5" class="progress-checkbox"> F.A.5</label>
                                                    <label><input type="checkbox" id="fa-G2E2-6" name="G2E2-FA" value="F.A.6" class="progress-checkbox"> F.A.6</label>
                                                    <label><input type="checkbox" id="fa-G2E2-7" name="G2E2-FA" value="F.A.7" class="progress-checkbox"> F.A.7</label>
                                                    <label><input type="checkbox" id="fa-G2E2-8" name="G2E2-FA" value="F.A.8" class="progress-checkbox"> F.A.8</label>
                                                </div>
                                            </div>
                                            <div class="assessment-type">
                                                <strong>Summative (S.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="sa-G2E2-1" name="G2E2-SA" value="S.A.1" class="progress-checkbox"> S.A.1</label>
                                                    <label><input type="checkbox" id="sa-G2E2-2" name="G2E2-SA" value="S.A.2" class="progress-checkbox"> S.A.2</label>
                                                    <label><input type="checkbox" id="sa-G2E2-3" name="G2E2-SA" value="S.A.3" class="progress-checkbox"> S.A.3</label>
                                                    <label><input type="checkbox" id="sa-G2E2-4" name="G2E2-SA" value="S.A.4" class="progress-checkbox"> S.A.4</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="level-group">
                                        <h4>G2E3</h4>
                                        <div class="assessment-selection">
                                            <div class="assessment-type">
                                                <strong>Formative (F.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="fa-G2E3-1" name="G2E3-FA" value="F.A.1" class="progress-checkbox"> F.A.1</label>
                                                    <label><input type="checkbox" id="fa-G2E3-2" name="G2E3-FA" value="F.A.2" class="progress-checkbox"> F.A.2</label>
                                                    <label><input type="checkbox" id="fa-G2E3-3" name="G2E3-FA" value="F.A.3" class="progress-checkbox"> F.A.3</label>
                                                    <label><input type="checkbox" id="fa-G2E3-4" name="G2E3-FA" value="F.A.4" class="progress-checkbox"> F.A.4</label>
                                                    <label><input type="checkbox" id="fa-G2E3-5" name="G2E3-FA" value="F.A.5" class="progress-checkbox"> F.A.5</label>
                                                    <label><input type="checkbox" id="fa-G2E3-6" name="G2E3-FA" value="F.A.6" class="progress-checkbox"> F.A.6</label>
                                                    <label><input type="checkbox" id="fa-G2E3-7" name="G2E3-FA" value="F.A.7" class="progress-checkbox"> F.A.7</label>
                                                    <label><input type="checkbox" id="fa-G2E3-8" name="G2E3-FA" value="F.A.8" class="progress-checkbox"> F.A.8</label>
                                                </div>
                                            </div>
                                            <div class="assessment-type">
                                                <strong>Summative (S.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="sa-G2E3-1" name="G2E3-SA" value="S.A.1" class="progress-checkbox"> S.A.1</label>
                                                    <label><input type="checkbox" id="sa-G2E3-2" name="G2E3-SA" value="S.A.2" class="progress-checkbox"> S.A.2</label>
                                                    <label><input type="checkbox" id="sa-G2E3-3" name="G2E3-SA" value="S.A.3" class="progress-checkbox"> S.A.3</label>
                                                    <label><input type="checkbox" id="sa-G2E3-4" name="G2E3-SA" value="S.A.4" class="progress-checkbox"> S.A.4</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="G3-tab" class="tab-content" style="display:none;">
                                <div class="level-groups">
                                    <div class="level-group">
                                        <h4>G3E1</h4>
                                        <div class="assessment-selection">
                                            <div class="assessment-type">
                                                <strong>Formative (F.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="fa-G3E1-1" name="G3E1-FA" value="F.A.1" class="progress-checkbox"> F.A.1</label>
                                                    <label><input type="checkbox" id="fa-G3E1-2" name="G3E1-FA" value="F.A.2" class="progress-checkbox"> F.A.2</label>
                                                    <label><input type="checkbox" id="fa-G3E1-3" name="G3E1-FA" value="F.A.3" class="progress-checkbox"> F.A.3</label>
                                                    <label><input type="checkbox" id="fa-G3E1-4" name="G3E1-FA" value="F.A.4" class="progress-checkbox"> F.A.4</label>
                                                    <label><input type="checkbox" id="fa-G3E1-5" name="G3E1-FA" value="F.A.5" class="progress-checkbox"> F.A.5</label>
                                                    <label><input type="checkbox" id="fa-G3E1-6" name="G3E1-FA" value="F.A.6" class="progress-checkbox"> F.A.6</label>
                                                    <label><input type="checkbox" id="fa-G3E1-7" name="G3E1-FA" value="F.A.7" class="progress-checkbox"> F.A.7</label>
                                                    <label><input type="checkbox" id="fa-G3E1-8" name="G3E1-FA" value="F.A.8" class="progress-checkbox"> F.A.8</label>
                                                </div>
                                            </div>
                                            <div class="assessment-type">
                                                <strong>Summative (S.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="sa-G3E1-1" name="G3E1-SA" value="S.A.1" class="progress-checkbox"> S.A.1</label>
                                                    <label><input type="checkbox" id="sa-G3E1-2" name="G3E1-SA" value="S.A.2" class="progress-checkbox"> S.A.2</label>
                                                    <label><input type="checkbox" id="sa-G3E1-3" name="G3E1-SA" value="S.A.3" class="progress-checkbox"> S.A.3</label>
                                                    <label><input type="checkbox" id="sa-G3E1-4" name="G3E1-SA" value="S.A.4" class="progress-checkbox"> S.A.4</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="level-group">
                                        <h4>G3E2</h4>
                                        <div class="assessment-selection">
                                            <div class="assessment-type">
                                                <strong>Formative (F.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="fa-G3E2-1" name="G3E2-FA" value="F.A.1" class="progress-checkbox"> F.A.1</label>
                                                    <label><input type="checkbox" id="fa-G3E2-2" name="G3E2-FA" value="F.A.2" class="progress-checkbox"> F.A.2</label>
                                                    <label><input type="checkbox" id="fa-G3E2-3" name="G3E2-FA" value="F.A.3" class="progress-checkbox"> F.A.3</label>
                                                    <label><input type="checkbox" id="fa-G3E2-4" name="G3E2-FA" value="F.A.4" class="progress-checkbox"> F.A.4</label>
                                                    <label><input type="checkbox" id="fa-G3E2-5" name="G3E2-FA" value="F.A.5" class="progress-checkbox"> F.A.5</label>
                                                    <label><input type="checkbox" id="fa-G3E2-6" name="G3E2-FA" value="F.A.6" class="progress-checkbox"> F.A.6</label>
                                                    <label><input type="checkbox" id="fa-G3E2-7" name="G3E2-FA" value="F.A.7" class="progress-checkbox"> F.A.7</label>
                                                    <label><input type="checkbox" id="fa-G3E2-8" name="G3E2-FA" value="F.A.8" class="progress-checkbox"> F.A.8</label>
                                                </div>
                                            </div>
                                            <div class="assessment-type">
                                                <strong>Summative (S.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="sa-G3E2-1" name="G3E2-SA" value="S.A.1" class="progress-checkbox"> S.A.1</label>
                                                    <label><input type="checkbox" id="sa-G3E2-2" name="G3E2-SA" value="S.A.2" class="progress-checkbox"> S.A.2</label>
                                                    <label><input type="checkbox" id="sa-G3E2-3" name="G3E2-SA" value="S.A.3" class="progress-checkbox"> S.A.3</label>
                                                    <label><input type="checkbox" id="sa-G3E2-4" name="G3E2-SA" value="S.A.4" class="progress-checkbox"> S.A.4</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="level-group">
                                        <h4>G3E3</h4>
                                        <div class="assessment-selection">
                                            <div class="assessment-type">
                                                <strong>Formative (F.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="fa-G3E3-1" name="G3E3-FA" value="F.A.1" class="progress-checkbox"> F.A.1</label>
                                                    <label><input type="checkbox" id="fa-G3E3-2" name="G3E3-FA" value="F.A.2" class="progress-checkbox"> F.A.2</label>
                                                    <label><input type="checkbox" id="fa-G3E3-3" name="G3E3-FA" value="F.A.3" class="progress-checkbox"> F.A.3</label>
                                                    <label><input type="checkbox" id="fa-G3E3-4" name="G3E3-FA" value="F.A.4" class="progress-checkbox"> F.A.4</label>
                                                    <label><input type="checkbox" id="fa-G3E3-5" name="G3E3-FA" value="F.A.5" class="progress-checkbox"> F.A.5</label>
                                                    <label><input type="checkbox" id="fa-G3E3-6" name="G3E3-FA" value="F.A.6" class="progress-checkbox"> F.A.6</label>
                                                    <label><input type="checkbox" id="fa-G3E3-7" name="G3E3-FA" value="F.A.7" class="progress-checkbox"> F.A.7</label>
                                                    <label><input type="checkbox" id="fa-G3E3-8" name="G3E3-FA" value="F.A.8" class="progress-checkbox"> F.A.8</label>
                                                </div>
                                            </div>
                                            <div class="assessment-type">
                                                <strong>Summative (S.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="sa-G3E3-1" name="G3E3-SA" value="S.A.1" class="progress-checkbox"> S.A.1</label>
                                                    <label><input type="checkbox" id="sa-G3E3-2" name="G3E3-SA" value="S.A.2" class="progress-checkbox"> S.A.2</label>
                                                    <label><input type="checkbox" id="sa-G3E3-3" name="G3E3-SA" value="S.A.3" class="progress-checkbox"> S.A.3</label>
                                                    <label><input type="checkbox" id="sa-G3E3-4" name="G3E3-SA" value="S.A.4" class="progress-checkbox"> S.A.4</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="G4-tab" class="tab-content" style="display:none;">
                                <div class="level-groups">
                                    <!-- G4E1 Level Group -->
                                    <div class="level-group">
                                        <h4>G4E1</h4>
                                        <div class="assessment-selection">
                                            <div class="assessment-type">
                                                <strong>Formative (F.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="fa-G4E1-1" name="G4E1-FA" value="F.A.1" class="progress-checkbox"> F.A.1</label>
                                                    <label><input type="checkbox" id="fa-G4E1-2" name="G4E1-FA" value="F.A.2" class="progress-checkbox"> F.A.2</label>
                                                    <label><input type="checkbox" id="fa-G4E1-3" name="G4E1-FA" value="F.A.3" class="progress-checkbox"> F.A.3</label>
                                                    <label><input type="checkbox" id="fa-G4E1-4" name="G4E1-FA" value="F.A.4" class="progress-checkbox"> F.A.4</label>
                                                    <label><input type="checkbox" id="fa-G4E1-5" name="G4E1-FA" value="F.A.5" class="progress-checkbox"> F.A.5</label>
                                                    <label><input type="checkbox" id="fa-G4E1-6" name="G4E1-FA" value="F.A.6" class="progress-checkbox"> F.A.6</label>
                                                    <label><input type="checkbox" id="fa-G4E1-7" name="G4E1-FA" value="F.A.7" class="progress-checkbox"> F.A.7</label>
                                                    <label><input type="checkbox" id="fa-G4E1-8" name="G4E1-FA" value="F.A.8" class="progress-checkbox"> F.A.8</label>
                                                </div>
                                            </div>
                                            <div class="assessment-type">
                                                <strong>Summative (S.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="sa-G4E1-1" name="G4E1-SA" value="S.A.1" class="progress-checkbox"> S.A.1</label>
                                                    <label><input type="checkbox" id="sa-G4E1-2" name="G4E1-SA" value="S.A.2" class="progress-checkbox"> S.A.2</label>
                                                    <label><input type="checkbox" id="sa-G4E1-3" name="G4E1-SA" value="S.A.3" class="progress-checkbox"> S.A.3</label>
                                                    <label><input type="checkbox" id="sa-G4E1-4" name="G4E1-SA" value="S.A.4" class="progress-checkbox"> S.A.4</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- G4E2 Level Group -->
                                    <div class="level-group">
                                        <h4>G4E2</h4>
                                        <div class="assessment-selection">
                                            <div class="assessment-type">
                                                <strong>Formative (F.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="fa-G4E2-1" name="G4E2-FA" value="F.A.1" class="progress-checkbox"> F.A.1</label>
                                                    <label><input type="checkbox" id="fa-G4E2-2" name="G4E2-FA" value="F.A.2" class="progress-checkbox"> F.A.2</label>
                                                    <label><input type="checkbox" id="fa-G4E2-3" name="G4E2-FA" value="F.A.3" class="progress-checkbox"> F.A.3</label>
                                                    <label><input type="checkbox" id="fa-G4E2-4" name="G4E2-FA" value="F.A.4" class="progress-checkbox"> F.A.4</label>
                                                    <label><input type="checkbox" id="fa-G4E2-5" name="G4E2-FA" value="F.A.5" class="progress-checkbox"> F.A.5</label>
                                                    <label><input type="checkbox" id="fa-G4E2-6" name="G4E2-FA" value="F.A.6" class="progress-checkbox"> F.A.6</label>
                                                    <label><input type="checkbox" id="fa-G4E2-7" name="G4E2-FA" value="F.A.7" class="progress-checkbox"> F.A.7</label>
                                                    <label><input type="checkbox" id="fa-G4E2-8" name="G4E2-FA" value="F.A.8" class="progress-checkbox"> F.A.8</label>
                                                </div>
                                            </div>
                                            <div class="assessment-type">
                                                <strong>Summative (S.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="sa-G4E2-1" name="G4E2-SA" value="S.A.1" class="progress-checkbox"> S.A.1</label>
                                                    <label><input type="checkbox" id="sa-G4E2-2" name="G4E2-SA" value="S.A.2" class="progress-checkbox"> S.A.2</label>
                                                    <label><input type="checkbox" id="sa-G4E2-3" name="G4E2-SA" value="S.A.3" class="progress-checkbox"> S.A.3</label>
                                                    <label><input type="checkbox" id="sa-G4E2-4" name="G4E2-SA" value="S.A.4" class="progress-checkbox"> S.A.4</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- G4E3 Level Group -->
                                    <div class="level-group">
                                        <h4>G4E3</h4>
                                        <div class="assessment-selection">
                                            <div class="assessment-type">
                                                <strong>Formative (F.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="fa-G4E3-1" name="G4E3-FA" value="F.A.1" class="progress-checkbox"> F.A.1</label>
                                                    <label><input type="checkbox" id="fa-G4E3-2" name="G4E3-FA" value="F.A.2" class="progress-checkbox"> F.A.2</label>
                                                    <label><input type="checkbox" id="fa-G4E3-3" name="G4E3-FA" value="F.A.3" class="progress-checkbox"> F.A.3</label>
                                                    <label><input type="checkbox" id="fa-G4E3-4" name="G4E3-FA" value="F.A.4" class="progress-checkbox"> F.A.4</label>
                                                    <label><input type="checkbox" id="fa-G4E3-5" name="G4E3-FA" value="F.A.5" class="progress-checkbox"> F.A.5</label>
                                                    <label><input type="checkbox" id="fa-G4E3-6" name="G4E3-FA" value="F.A.6" class="progress-checkbox"> F.A.6</label>
                                                    <label><input type="checkbox" id="fa-G4E3-7" name="G4E3-FA" value="F.A.7" class="progress-checkbox"> F.A.7</label>
                                                    <label><input type="checkbox" id="fa-G4E3-8" name="G4E3-FA" value="F.A.8" class="progress-checkbox"> F.A.8</label>
                                                </div>
                                            </div>
                                            <div class="assessment-type">
                                                <strong>Summative (S.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="sa-G4E3-1" name="G4E3-SA" value="S.A.1" class="progress-checkbox"> S.A.1</label>
                                                    <label><input type="checkbox" id="sa-G4E3-2" name="G4E3-SA" value="S.A.2" class="progress-checkbox"> S.A.2</label>
                                                    <label><input type="checkbox" id="sa-G4E3-3" name="G4E3-SA" value="S.A.3" class="progress-checkbox"> S.A.3</label>
                                                    <label><input type="checkbox" id="sa-G4E3-4" name="G4E3-SA" value="S.A.4" class="progress-checkbox"> S.A.4</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="G5-tab" class="tab-content" style="display:none;">
                                <div class="level-groups">
                                    <!-- G5E1 Level Group -->
                                    <div class="level-group">
                                        <h4>G5E1</h4>
                                        <div class="assessment-selection">
                                            <div class="assessment-type">
                                                <strong>Formative (F.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="fa-G5E1-1" name="G5E1-FA" value="F.A.1" class="progress-checkbox"> F.A.1</label>
                                                    <label><input type="checkbox" id="fa-G5E1-2" name="G5E1-FA" value="F.A.2" class="progress-checkbox"> F.A.2</label>
                                                    <label><input type="checkbox" id="fa-G5E1-3" name="G5E1-FA" value="F.A.3" class="progress-checkbox"> F.A.3</label>
                                                    <label><input type="checkbox" id="fa-G5E1-4" name="G5E1-FA" value="F.A.4" class="progress-checkbox"> F.A.4</label>
                                                    <label><input type="checkbox" id="fa-G5E1-5" name="G5E1-FA" value="F.A.5" class="progress-checkbox"> F.A.5</label>
                                                    <label><input type="checkbox" id="fa-G5E1-6" name="G5E1-FA" value="F.A.6" class="progress-checkbox"> F.A.6</label>
                                                    <label><input type="checkbox" id="fa-G5E1-7" name="G5E1-FA" value="F.A.7" class="progress-checkbox"> F.A.7</label>
                                                    <label><input type="checkbox" id="fa-G5E1-8" name="G5E1-FA" value="F.A.8" class="progress-checkbox"> F.A.8</label>
                                                </div>
                                            </div>
                                            <div class="assessment-type">
                                                <strong>Summative (S.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="sa-G5E1-1" name="G5E1-SA" value="S.A.1" class="progress-checkbox"> S.A.1</label>
                                                    <label><input type="checkbox" id="sa-G5E1-2" name="G5E1-SA" value="S.A.2" class="progress-checkbox"> S.A.2</label>
                                                    <label><input type="checkbox" id="sa-G5E1-3" name="G5E1-SA" value="S.A.3" class="progress-checkbox"> S.A.3</label>
                                                    <label><input type="checkbox" id="sa-G5E1-4" name="G5E1-SA" value="S.A.4" class="progress-checkbox"> S.A.4</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- G5E2 Level Group -->
                                    <div class="level-group">
                                        <h4>G5E2</h4>
                                        <div class="assessment-selection">
                                            <div class="assessment-type">
                                                <strong>Formative (F.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="fa-G5E2-1" name="G5E2-FA" value="F.A.1" class="progress-checkbox"> F.A.1</label>
                                                    <label><input type="checkbox" id="fa-G5E2-2" name="G5E2-FA" value="F.A.2" class="progress-checkbox"> F.A.2</label>
                                                    <label><input type="checkbox" id="fa-G5E2-3" name="G5E2-FA" value="F.A.3" class="progress-checkbox"> F.A.3</label>
                                                    <label><input type="checkbox" id="fa-G5E2-4" name="G5E2-FA" value="F.A.4" class="progress-checkbox"> F.A.4</label>
                                                    <label><input type="checkbox" id="fa-G5E2-5" name="G5E2-FA" value="F.A.5" class="progress-checkbox"> F.A.5</label>
                                                    <label><input type="checkbox" id="fa-G5E2-6" name="G5E2-FA" value="F.A.6" class="progress-checkbox"> F.A.6</label>
                                                    <label><input type="checkbox" id="fa-G5E2-7" name="G5E2-FA" value="F.A.7" class="progress-checkbox"> F.A.7</label>
                                                    <label><input type="checkbox" id="fa-G5E2-8" name="G5E2-FA" value="F.A.8" class="progress-checkbox"> F.A.8</label>
                                                </div>
                                            </div>
                                            <div class="assessment-type">
                                                <strong>Summative (S.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="sa-G5E2-1" name="G5E2-SA" value="S.A.1" class="progress-checkbox"> S.A.1</label>
                                                    <label><input type="checkbox" id="sa-G5E2-2" name="G5E2-SA" value="S.A.2" class="progress-checkbox"> S.A.2</label>
                                                    <label><input type="checkbox" id="sa-G5E2-3" name="G5E2-SA" value="S.A.3" class="progress-checkbox"> S.A.3</label>
                                                    <label><input type="checkbox" id="sa-G5E2-4" name="G5E2-SA" value="S.A.4" class="progress-checkbox"> S.A.4</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- G5E3 Level Group -->
                                    <div class="level-group">
                                        <h4>G5E3</h4>
                                        <div class="assessment-selection">
                                            <div class="assessment-type">
                                                <strong>Formative (F.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="fa-G5E3-1" name="G5E3-FA" value="F.A.1" class="progress-checkbox"> F.A.1</label>
                                                    <label><input type="checkbox" id="fa-G5E3-2" name="G5E3-FA" value="F.A.2" class="progress-checkbox"> F.A.2</label>
                                                    <label><input type="checkbox" id="fa-G5E3-3" name="G5E3-FA" value="F.A.3" class="progress-checkbox"> F.A.3</label>
                                                    <label><input type="checkbox" id="fa-G5E3-4" name="G5E3-FA" value="F.A.4" class="progress-checkbox"> F.A.4</label>
                                                    <label><input type="checkbox" id="fa-G5E3-5" name="G5E3-FA" value="F.A.5" class="progress-checkbox"> F.A.5</label>
                                                    <label><input type="checkbox" id="fa-G5E3-6" name="G5E3-FA" value="F.A.6" class="progress-checkbox"> F.A.6</label>
                                                    <label><input type="checkbox" id="fa-G5E3-7" name="G5E3-FA" value="F.A.7" class="progress-checkbox"> F.A.7</label>
                                                    <label><input type="checkbox" id="fa-G5E3-8" name="G5E3-FA" value="F.A.8" class="progress-checkbox"> F.A.8</label>
                                                </div>
                                            </div>
                                            <div class="assessment-type">
                                                <strong>Summative (S.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="sa-G5E3-1" name="G5E3-SA" value="S.A.1" class="progress-checkbox"> S.A.1</label>
                                                    <label><input type="checkbox" id="sa-G5E3-2" name="G5E3-SA" value="S.A.2" class="progress-checkbox"> S.A.2</label>
                                                    <label><input type="checkbox" id="sa-G5E3-3" name="G5E3-SA" value="S.A.3" class="progress-checkbox"> S.A.3</label>
                                                    <label><input type="checkbox" id="sa-G5E3-4" name="G5E3-SA" value="S.A.4" class="progress-checkbox"> S.A.4</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="G6-tab" class="tab-content" style="display:none;">
                                <div class="level-groups">
                                    <!-- G6E1 Level Group -->
                                    <div class="level-group">
                                        <h4>G6E1</h4>
                                        <div class="assessment-selection">
                                            <div class="assessment-type">
                                                <strong>Formative (F.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="fa-G6E1-1" name="G6E1-FA" value="F.A.1" class="progress-checkbox"> F.A.1</label>
                                                    <label><input type="checkbox" id="fa-G6E1-2" name="G6E1-FA" value="F.A.2" class="progress-checkbox"> F.A.2</label>
                                                    <label><input type="checkbox" id="fa-G6E1-3" name="G6E1-FA" value="F.A.3" class="progress-checkbox"> F.A.3</label>
                                                    <label><input type="checkbox" id="fa-G6E1-4" name="G6E1-FA" value="F.A.4" class="progress-checkbox"> F.A.4</label>
                                                    <label><input type="checkbox" id="fa-G6E1-5" name="G6E1-FA" value="F.A.5" class="progress-checkbox"> F.A.5</label>
                                                    <label><input type="checkbox" id="fa-G6E1-6" name="G6E1-FA" value="F.A.6" class="progress-checkbox"> F.A.6</label>
                                                    <label><input type="checkbox" id="fa-G6E1-7" name="G6E1-FA" value="F.A.7" class="progress-checkbox"> F.A.7</label>
                                                    <label><input type="checkbox" id="fa-G6E1-8" name="G6E1-FA" value="F.A.8" class="progress-checkbox"> F.A.8</label>
                                                </div>
                                            </div>
                                            <div class="assessment-type">
                                                <strong>Summative (S.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="sa-G6E1-1" name="G6E1-SA" value="S.A.1" class="progress-checkbox"> S.A.1</label>
                                                    <label><input type="checkbox" id="sa-G6E1-2" name="G6E1-SA" value="S.A.2" class="progress-checkbox"> S.A.2</label>
                                                    <label><input type="checkbox" id="sa-G6E1-3" name="G6E1-SA" value="S.A.3" class="progress-checkbox"> S.A.3</label>
                                                    <label><input type="checkbox" id="sa-G6E1-4" name="G6E1-SA" value="S.A.4" class="progress-checkbox"> S.A.4</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- G6E2 Level Group -->
                                    <div class="level-group">
                                        <h4>G6E2</h4>
                                        <div class="assessment-selection">
                                            <div class="assessment-type">
                                                <strong>Formative (F.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="fa-G6E2-1" name="G6E2-FA" value="F.A.1" class="progress-checkbox"> F.A.1</label>
                                                    <label><input type="checkbox" id="fa-G6E2-2" name="G6E2-FA" value="F.A.2" class="progress-checkbox"> F.A.2</label>
                                                    <label><input type="checkbox" id="fa-G6E2-3" name="G6E2-FA" value="F.A.3" class="progress-checkbox"> F.A.3</label>
                                                    <label><input type="checkbox" id="fa-G6E2-4" name="G6E2-FA" value="F.A.4" class="progress-checkbox"> F.A.4</label>
                                                    <label><input type="checkbox" id="fa-G6E2-5" name="G6E2-FA" value="F.A.5" class="progress-checkbox"> F.A.5</label>
                                                    <label><input type="checkbox" id="fa-G6E2-6" name="G6E2-FA" value="F.A.6" class="progress-checkbox"> F.A.6</label>
                                                    <label><input type="checkbox" id="fa-G6E2-7" name="G6E2-FA" value="F.A.7" class="progress-checkbox"> F.A.7</label>
                                                    <label><input type="checkbox" id="fa-G6E2-8" name="G6E2-FA" value="F.A.8" class="progress-checkbox"> F.A.8</label>
                                                </div>
                                            </div>
                                            <div class="assessment-type">
                                                <strong>Summative (S.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="sa-G6E2-1" name="G6E2-SA" value="S.A.1" class="progress-checkbox"> S.A.1</label>
                                                    <label><input type="checkbox" id="sa-G6E2-2" name="G6E2-SA" value="S.A.2" class="progress-checkbox"> S.A.2</label>
                                                    <label><input type="checkbox" id="sa-G6E2-3" name="G6E2-SA" value="S.A.3" class="progress-checkbox"> S.A.3</label>
                                                    <label><input type="checkbox" id="sa-G6E2-4" name="G6E2-SA" value="S.A.4" class="progress-checkbox"> S.A.4</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- G6E3 Level Group -->
                                    <div class="level-group">
                                        <h4>G6E3</h4>
                                        <div class="assessment-selection">
                                            <div class="assessment-type">
                                                <strong>Formative (F.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="fa-G6E3-1" name="G6E3-FA" value="F.A.1" class="progress-checkbox"> F.A.1</label>
                                                    <label><input type="checkbox" id="fa-G6E3-2" name="G6E3-FA" value="F.A.2" class="progress-checkbox"> F.A.2</label>
                                                    <label><input type="checkbox" id="fa-G6E3-3" name="G6E3-FA" value="F.A.3" class="progress-checkbox"> F.A.3</label>
                                                    <label><input type="checkbox" id="fa-G6E3-4" name="G6E3-FA" value="F.A.4" class="progress-checkbox"> F.A.4</label>
                                                    <label><input type="checkbox" id="fa-G6E3-5" name="G6E3-FA" value="F.A.5" class="progress-checkbox"> F.A.5</label>
                                                    <label><input type="checkbox" id="fa-G6E3-6" name="G6E3-FA" value="F.A.6" class="progress-checkbox"> F.A.6</label>
                                                    <label><input type="checkbox" id="fa-G6E3-7" name="G6E3-FA" value="F.A.7" class="progress-checkbox"> F.A.7</label>
                                                    <label><input type="checkbox" id="fa-G6E3-8" name="G6E3-FA" value="F.A.8" class="progress-checkbox"> F.A.8</label>
                                                </div>
                                            </div>
                                            <div class="assessment-type">
                                                <strong>Summative (S.A.):</strong>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" id="sa-G6E3-1" name="G6E3-SA" value="S.A.1" class="progress-checkbox"> S.A.1</label>
                                                    <label><input type="checkbox" id="sa-G6E3-2" name="G6E3-SA" value="S.A.2" class="progress-checkbox"> S.A.2</label>
                                                    <label><input type="checkbox" id="sa-G6E3-3" name="G6E3-SA" value="S.A.3" class="progress-checkbox"> S.A.3</label>
                                                    <label><input type="checkbox" id="sa-G6E3-4" name="G6E3-SA" value="S.A.4" class="progress-checkbox"> S.A.4</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="runProgressAudit()">
                                <i class="fas fa-play"></i> Run Audit | Âü∑Ë°åÁ®ΩÊ†∏
                            </button>
                            <button class="btn btn-secondary" onclick="closeProgressAuditModal()">
                                <i class="fas fa-times"></i> Cancel | ÂèñÊ∂à
                            </button>
                        </div>
                        
                        <!-- Loading Indicator -->
                        <div id="progress-audit-loading" class="loading-indicator" style="display: none;">
                            <div class="loading-content">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span>Analyzing progress... | Ê≠£Âú®ÂàÜÊûêÈÄ≤Â∫¶...</span>
                            </div>
                        </div>
                        
                        <!-- Message Display -->
                        <div id="progress-audit-message" class="progress-audit-message" style="display: none;"></div>
                        
                        <!-- Results Display -->
                        <div id="progress-audit-results" class="progress-results" style="display: none;">
                            <!-- Audit results will be displayed here -->
                        </div>
                        
                        <!-- Legacy result div for compatibility -->
                        <div id="progress-audit-result" class="result-section" style="display: none;">
                            <!-- Backup results display -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let isLoading = false;

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', function() {
            updateTimestamp();
            loadSystemStatistics();
            setInterval(updateTimestamp, 60000); // Update every minute
        });

        // Update timestamp
        function updateTimestamp() {
            const now = new Date();
            document.getElementById('last-updated').textContent = now.toLocaleString();
        }

        // Show loading indicator
        function showLoading() {
            if (isLoading) return;
            isLoading = true;
            document.getElementById('loading').style.display = 'block';
            hideAlerts();
        }

        // Hide loading indicator
        function hideLoading() {
            isLoading = false;
            document.getElementById('loading').style.display = 'none';
        }

        // Show success message
        function showSuccess(message) {
            const alert = document.getElementById('alert-success');
            alert.textContent = message;
            alert.style.display = 'block';
            setTimeout(() => alert.style.display = 'none', 5000);
        }

        // Show error message
        function showError(message) {
            const alert = document.getElementById('alert-error');
            alert.textContent = message;
            alert.style.display = 'block';
            setTimeout(() => alert.style.display = 'none', 5000);
        }

        // Hide all alerts
        function hideAlerts() {
            document.getElementById('alert-success').style.display = 'none';
            document.getElementById('alert-error').style.display = 'none';
        }

        // System Functions
        function initializeSystem() {
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    
                    // Check if result indicates success or failure
                    if (result && result.success) {
                        showSuccess('‚úÖ System initialized successfully! | Á≥ªÁµ±ÂàùÂßãÂåñÊàêÂäüÔºÅ');
                        console.log('Initialization details:', result.details);
                        loadSystemStatistics();
                    } else {
                        // Backend returned failure result
                        const errorMsg = result ? result.error : 'Unknown initialization error';
                        const details = result ? result.details : '';
                        showError('‚ùå Initialization failed: ' + errorMsg + ' | ÂàùÂßãÂåñÂ§±Êïó' + (details ? '\n\nDetails: ' + details : ''));
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('‚ùå Initialization failed: ' + error.message + ' | ÂàùÂßãÂåñÂ§±Êïó');
                })
                .initializeSystemForWebApp();
        }

        function checkSystemStatus() {
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    showSuccess('üü¢ System Status: Healthy | Á≥ªÁµ±ÁãÄÊÖãÂÅ•Â∫∑');
                    loadSystemStatistics();
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('‚ùå Status check failed: ' + error.message + ' | ÁãÄÊÖãÊ™¢Êü•Â§±Êïó');
                })
                .getSystemStatistics();
        }

        function refreshDashboard() {
            showLoading();
            loadSystemStatistics();
            setTimeout(() => {
                hideLoading();
                showSuccess('‚úÖ Dashboard refreshed successfully!');
            }, 1000);
        }

        function openHTDashboard() {
            // FIXED: Always use the correct deployment URL
            const htUrl = 'https://script.google.com/macros/s/AKfycbwQD6FGVvt3R4_L5RGS8BB7yapJlE8S9gd4E8HyJRI/exec?page=ht';
            
            console.log('Opening HT Dashboard:', htUrl);
            window.open(htUrl, '_blank');
        }

        function loadSystemStatistics() {
            google.script.run
                .withSuccessHandler(function(stats) {
                    document.getElementById('total-teachers').textContent = stats.totalTeachers || 0;
                    document.getElementById('total-students').textContent = stats.totalStudents || 0;
                    document.getElementById('active-gradebooks').textContent = stats.activeGradebooks || 0;
                    document.getElementById('system-files').textContent = stats.systemFiles || 0;
                })
                .withFailureHandler(function(error) {
                    console.error('Failed to load statistics:', error);
                })
                .getSystemStatistics();
        }

        function openSystemFolder() {
            google.script.run
                .withSuccessHandler(function(result) {
                    if (result.success) {
                        window.open(result.url, '_blank');
                        showSuccess('üìÅ Opening system folder');
                    } else {
                        showError('‚ùå Cannot open system folder: ' + result.error);
                    }
                })
                .withFailureHandler(function(error) {
                    showError('‚ùå Cannot open system folder: ' + error.message);
                })
                .getSystemFolderUrl();
        }

        function openMasterData() {
            google.script.run
                .withSuccessHandler(function(result) {
                    if (result.success) {
                        window.open(result.url, '_blank');
                        showSuccess('üìã Opening master data sheet: ' + result.name);
                    } else {
                        let errorMessage = '‚ùå Cannot open master data: ' + result.error;
                        if (result.step) {
                            errorMessage += '\n\nFailed at step: ' + result.step;
                        }
                        if (result.filesInFolder) {
                            errorMessage += '\n\nFiles found: ' + result.filesInFolder.join(', ');
                        }
                        showError(errorMessage);
                    }
                })
                .withFailureHandler(function(error) {
                    showError('‚ùå Cannot open master data: ' + error.message);
                })
                .getMasterDataUrl();
        }


        // Batch create gradebooks functionality
        function batchCreateGradebooks() {
            if (!confirm('This will create gradebooks for all teachers. This process may take several minutes. Continue?')) {
                return;
            }
            
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result && result.success) {
                        let message = `üéâ Gradebook creation completed!\n\n`;
                        message += `‚úÖ Successfully created: ${result.successCount} gradebooks\n`;
                        if (result.errorCount > 0) {
                            message += `‚ùå Errors: ${result.errorCount} gradebooks\n`;
                        }
                        message += `‚è±Ô∏è Total time: ${result.duration} seconds\n`;
                        message += `üë• Total teachers: ${result.totalTeachers}`;
                        
                        if (result.errors && result.errors.length > 0) {
                            message += `\n\n‚ö†Ô∏è Errors encountered:\n${result.errors.slice(0, 5).join('\n')}`;
                            if (result.errors.length > 5) {
                                message += `\n... and ${result.errors.length - 5} more errors`;
                            }
                        }
                        
                        showSuccess(message);
                        loadSystemStatistics();
                    } else {
                        showError('‚ùå Gradebook creation failed: ' + (result.message || result.error || 'Unknown error'));
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('‚ùå Failed to create gradebooks: ' + error.message);
                })
                .batchCreateGradebooks();
        }

        // Progress Check Functions | ÈÄ≤Â∫¶Ê™¢Êü•ÂáΩÊï∏
        function quickProgressCheck() {
            if (!confirm('This will check progress for all teachers with default standards (3 F.A. + 1 S.A.). Continue?\n\nÈÄôÂ∞á‰ΩøÁî®È†êË®≠Ê®ôÊ∫ñÔºà3Ê¨°Âπ≥ÊôÇË©ïÈáè + 1Ê¨°Á∏ΩÁµêË©ïÈáèÔºâÊ™¢Êü•ÊâÄÊúâÊïôÂ∏´ÈÄ≤Â∫¶„ÄÇÁπºÁ∫åÔºü')) {
                return;
            }
            
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result.success) {
                        displayProgressCheckResults(result.summary);
                        showSuccess(`‚úÖ Progress check completed in ${result.duration}s\nüìä Checked ${result.summary.totalClasses} classes from ${result.summary.totalTeachers} teachers`);
                        if (result.reportUrl) {
                            setTimeout(() => {
                                if (confirm('View detailed progress report?\nÊü•ÁúãË©≥Á¥∞ÈÄ≤Â∫¶Â†±ÂëäÔºü')) {
                                    window.open(result.reportUrl, '_blank');
                                }
                            }, 2000);
                        }
                    } else {
                        showError('‚ùå Progress check failed: ' + result.error);
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('‚ùå Progress check failed: ' + error.message);
                })
                .batchCheckAllProgress();
        }

        function openProgressStandardsDialog() {
            const html = `
                <div style="padding: 20px; font-family: Arial, sans-serif; max-width: 500px;">
                    <h2 style="color: #4285F4; margin-bottom: 20px;">
                        <i class="fas fa-cogs"></i> Set Progress Check Standards | Ë®≠ÂÆöÈÄ≤Â∫¶Ê™¢Êü•Ê®ôÊ∫ñ
                    </h2>
                    
                    <div style="margin: 15px 0;">
                        <label style="font-weight: bold;">Check Description | Ê™¢Êü•ÊèèËø∞:</label><br>
                        <input type="text" id="checkDescription" value="Progress Check - Week 8" 
                               style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <label style="font-weight: bold;">Required Formative Assessments | ÈúÄÂÆåÊàêÂπ≥ÊôÇË©ïÈáè:</label><br>
                        <select id="formativeRequired" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="0">0 - No F.A. required</option>
                            <option value="1">1 - F.A.1</option>
                            <option value="2">2 - F.A.1, F.A.2</option>
                            <option value="3" selected>3 - F.A.1, F.A.2, F.A.3</option>
                            <option value="4">4 - F.A.1 to F.A.4</option>
                            <option value="5">5 - F.A.1 to F.A.5</option>
                            <option value="6">6 - F.A.1 to F.A.6</option>
                            <option value="7">7 - F.A.1 to F.A.7</option>
                            <option value="8">8 - All F.A. (F.A.1 to F.A.8)</option>
                        </select>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <label style="font-weight: bold;">Required Summative Assessments | ÈúÄÂÆåÊàêÁ∏ΩÁµêË©ïÈáè:</label><br>
                        <select id="summativeRequired" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="0">0 - No S.A. required</option>
                            <option value="1" selected>1 - S.A.1</option>
                            <option value="2">2 - S.A.1, S.A.2</option>
                            <option value="3">3 - S.A.1, S.A.2, S.A.3</option>
                            <option value="4">4 - All S.A. (S.A.1 to S.A.4)</option>
                        </select>
                    </div>
                    
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 5px; margin: 15px 0;">
                        <h4 style="margin: 0 0 10px 0; color: #1976d2;">Progress Standards | ÈÄ≤Â∫¶Ê®ôÊ∫ñ:</h4>
                        <ul style="margin: 5px 0; padding-left: 20px; color: #555;">
                            <li>üü¢ Excellent (‚â•90%): ÈÄ≤Â∫¶ÂÑ™ÁßÄ</li>
                            <li>üü° Good (80-89%): ÈÄ≤Â∫¶ËâØÂ•Ω</li>
                            <li>üü† Normal (60-79%): ÈÄ≤Â∫¶Ê≠£Â∏∏</li>
                            <li>üî¥ Behind (<60%): ÈÄ≤Â∫¶ËêΩÂæå</li>
                        </ul>
                        <p style="font-size: 0.9em; color: #666; margin: 10px 0 0 0;">
                            System will check: Empty cells and 0 scores = incomplete, "N" and scores >0 = complete
                        </p>
                    </div>
                    
                    <div style="margin: 20px 0; text-align: center;">
                        <button onclick="executeCustomProgressCheck()" 
                                style="background: #4CAF50; color: white; padding: 12px 24px; border: none; border-radius: 5px; margin-right: 10px; cursor: pointer; font-size: 16px;">
                            üöÄ Start Custom Check | ÈñãÂßãËá™Ë®ÇÊ™¢Êü•
                        </button>
                        <button onclick="closeProgressDialog()" 
                                style="background: #999; color: white; padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
                            Cancel | ÂèñÊ∂à
                        </button>
                    </div>
                </div>
            `;
            
            // Create modal overlay
            const overlay = document.createElement('div');
            overlay.id = 'progressModal';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.5); z-index: 1000; display: flex;
                justify-content: center; align-items: center;
            `;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: white; border-radius: 10px; box-shadow: 0 25px 50px rgba(0,0,0,0.3);
                max-width: 90%; max-height: 90%; overflow-y: auto;
            `;
            modal.innerHTML = html;
            
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
            
            // Add global functions for modal
            window.executeCustomProgressCheck = function() {
                const description = document.getElementById('checkDescription').value;
                const formativeRequired = parseInt(document.getElementById('formativeRequired').value);
                const summativeRequired = parseInt(document.getElementById('summativeRequired').value);
                
                const standards = {
                    formativeRequired: formativeRequired,
                    summativeRequired: summativeRequired,
                    finalRequired: 0,
                    description: description,
                    checkDate: new Date()
                };
                
                closeProgressDialog();
                
                showLoading();
                google.script.run
                    .withSuccessHandler(function(result) {
                        hideLoading();
                        if (result.success) {
                            displayProgressCheckResults(result.summary);
                            showSuccess(`‚úÖ Custom progress check completed in ${result.duration}s\nüìä Standard: ${formativeRequired} F.A. + ${summativeRequired} S.A.`);
                            if (result.reportUrl) {
                                setTimeout(() => {
                                    if (confirm('View detailed progress report?\nÊü•ÁúãË©≥Á¥∞ÈÄ≤Â∫¶Â†±ÂëäÔºü')) {
                                        window.open(result.reportUrl, '_blank');
                                    }
                                }, 2000);
                            }
                        } else {
                            showError('‚ùå Custom progress check failed: ' + result.error);
                        }
                    })
                    .withFailureHandler(function(error) {
                        hideLoading();
                        showError('‚ùå Custom progress check failed: ' + error.message);
                    })
                    .batchCheckAllProgress(standards);
            };
            
            window.closeProgressDialog = function() {
                const modal = document.getElementById('progressModal');
                if (modal) {
                    document.body.removeChild(modal);
                }
            };
        }

        function displayProgressCheckResults(summary) {
            const resultHtml = `
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 10px 0;">
                    <h3 style="color: #4285F4; margin: 0 0 15px 0;">
                        üìä Progress Check Results | ÈÄ≤Â∫¶Ê™¢Êü•ÁµêÊûú
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 2em; font-weight: bold; color: #4285F4;">${summary.totalTeachers}</div>
                            <div>Teachers Checked<br>Â∑≤Ê™¢Êü•ÊïôÂ∏´</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2em; font-weight: bold; color: #4285F4;">${summary.totalClasses}</div>
                            <div>Total Classes<br>Áè≠Á¥öÁ∏ΩÊï∏</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2em; font-weight: bold; color: #4CAF50;">${summary.classesOnTrack}</div>
                            <div>Classes On Track<br>ÈÄ≤Â∫¶Ê≠£Â∏∏</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2em; font-weight: bold; color: #f44336;">${summary.classesBehind}</div>
                            <div>Classes Behind<br>ÈÄ≤Â∫¶ËêΩÂæå</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2em; font-weight: bold; color: #FF9800;">${summary.systemProgress.toFixed(1)}%</div>
                            <div>System Progress<br>Á≥ªÁµ±ÈÄ≤Â∫¶</div>
                        </div>
                    </div>
                    ${summary.classesBehind > 0 ? `
                        <div style="background: #ffebee; padding: 15px; border-radius: 5px; margin-top: 15px; border-left: 4px solid #f44336;">
                            <strong style="color: #d32f2f;">‚ö†Ô∏è Alert: ${summary.classesBehind} classes are behind schedule</strong>
                            <br><small>Check the detailed report for specific recommendations</small>
                        </div>
                    ` : `
                        <div style="background: #e8f5e8; padding: 15px; border-radius: 5px; margin-top: 15px; border-left: 4px solid #4CAF50;">
                            <strong style="color: #2e7d32;">‚úÖ Excellent: All classes are on track!</strong>
                        </div>
                    `}
                </div>
            `;
            
            // Display in alert area or create temporary display
            const alertDiv = document.createElement('div');
            alertDiv.innerHTML = resultHtml;
            alertDiv.style.cssText = 'position: fixed; top: 20%; left: 50%; transform: translateX(-50%); z-index: 999; background: white; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 90%; max-height: 70%; overflow-y: auto;';
            
            const closeBtn = document.createElement('button');
            closeBtn.innerHTML = '‚úï';
            closeBtn.style.cssText = 'position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 18px; cursor: pointer; color: #999;';
            closeBtn.onclick = () => document.body.removeChild(alertDiv);
            
            alertDiv.appendChild(closeBtn);
            document.body.appendChild(alertDiv);
            
            // Auto remove after 10 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    document.body.removeChild(alertDiv);
                }
            }, 10000);
        }

        function generateReport() {
            showSuccess('üìã Report generation feature coming soon!');
        }

        function importStudentData() {
            showSuccess('üì• Import feature coming soon!');
        }

        function exportStudentData() {
            showSuccess('üì§ Export feature coming soon!');
        }

        function systemBackup() {
            showSuccess('üîÑ Backup feature coming soon!');
        }

        function testSystemIntegrity() {
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result.success) {
                        showSuccess(`‚úÖ System Test Passed!\n\n${result.summary}\n\nAll critical functions are working properly.`);
                    } else {
                        let message = `‚ùå System Test Issues Found:\n\n${result.summary}`;
                        if (result.errors && result.errors.length > 0) {
                            message += `\n\nErrors:\n${result.errors.join('\n')}`;
                        }
                        showError(message);
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('‚ùå System test failed: ' + error.message);
                })
                .testSystemIntegrity();
        }

        function performQualityCheck() {
            if (!confirm('This will perform a comprehensive code quality and security analysis. This may take 1-2 minutes. Continue?\n\nÈÄôÂ∞áÂü∑Ë°åÂÖ®Èù¢ÁöÑ‰ª£Á¢ºÂìÅË≥™ÂíåÂÆâÂÖ®ÂàÜÊûêÔºåÂèØËÉΩÈúÄË¶Å1-2ÂàÜÈêò„ÄÇÁπºÁ∫åÔºü')) {
                return;
            }
            
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result.success) {
                        let message = `üìä Code Quality Analysis Complete!\n\n${result.summary}\n\n${result.report}`;
                        if (result.recommendations && result.recommendations.length > 0) {
                            message += `\n\nüéØ Recommendations:\n${result.recommendations.map(r => `‚Ä¢ ${r}`).join('\n')}`;
                        }
                        showSuccess(message);
                    } else {
                        showError('‚ùå Quality check failed: ' + (result.error || 'Unknown error'));
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('‚ùå Quality check failed: ' + error.message);
                })
                .performCodeQualityCheck();
        }

        function openResourceManager() {
            const resourceTypes = ['template', 'function', 'integration', 'documentation', 'tool', 'component'];
            const typeDescriptions = {
                'template': 'Spreadsheet templates for reports, assessments, etc.',
                'function': 'Utility functions and code libraries',
                'integration': 'Third-party service integrations',
                'documentation': 'User guides and technical documentation',
                'tool': 'System utilities and helper tools',
                'component': 'UI components and interface elements'
            };
            
            let optionsHtml = resourceTypes.map(type => 
                `<option value="${type}">${type.charAt(0).toUpperCase() + type.slice(1)} - ${typeDescriptions[type]}</option>`
            ).join('');
            
            const html = `
                <div style="padding: 20px; font-family: Arial, sans-serif; max-width: 500px;">
                    <h2>üîß Add New Project Resource | Ê∑ªÂä†Êñ∞Â∞àÊ°àË≥áÊ∫ê</h2>
                    
                    <div style="margin: 15px 0;">
                        <label><strong>Resource Type | Ë≥áÊ∫êÈ°ûÂûã:</strong></label><br>
                        <select id="resourceType" style="width: 100%; padding: 8px; margin-top: 5px;">
                            ${optionsHtml}
                        </select>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <label><strong>Resource Name | Ë≥áÊ∫êÂêçÁ®±:</strong></label><br>
                        <input type="text" id="resourceName" placeholder="e.g., Grade Report Template" 
                               style="width: 100%; padding: 8px; margin-top: 5px;">
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <label><strong>Description | ÊèèËø∞:</strong></label><br>
                        <textarea id="resourceDescription" rows="3" 
                                  placeholder="Brief description of what this resource does..."
                                  style="width: 100%; padding: 8px; margin-top: 5px; resize: vertical;"></textarea>
                    </div>
                    
                    <div style="margin: 20px 0; display: flex; gap: 10px;">
                        <button onclick="createNewResource()" 
                                style="background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; flex: 1;">
                            üöÄ Create Resource | ÂâµÂª∫Ë≥áÊ∫ê
                        </button>
                        <button onclick="listExistingResources()" 
                                style="background: #2196F3; color: white; padding: 10px 20px; border: none; border-radius: 5px; flex: 1;">
                            üìã List Resources | ÂàóÂá∫Ë≥áÊ∫ê
                        </button>
                    </div>
                    
                    <div id="resourceResult" style="margin-top: 15px; padding: 10px; background: #f5f5f5; border-radius: 5px; display: none;">
                    </div>
                </div>
            `;
            
            showModal('Resource Manager | Ë≥áÊ∫êÁÆ°ÁêÜÂô®', html);
        }

        function createNewResource() {
            const type = document.getElementById('resourceType').value;
            const name = document.getElementById('resourceName').value;
            const description = document.getElementById('resourceDescription').value;
            
            if (!name.trim()) {
                alert('Please enter a resource name | Ë´ãËº∏ÂÖ•Ë≥áÊ∫êÂêçÁ®±');
                return;
            }
            
            if (!description.trim()) {
                alert('Please enter a description | Ë´ãËº∏ÂÖ•ÊèèËø∞');
                return;
            }
            
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result.success) {
                        const resultDiv = document.getElementById('resourceResult');
                        resultDiv.style.display = 'block';
                        resultDiv.innerHTML = `
                            <h4>‚úÖ Resource Created Successfully! | Ë≥áÊ∫êÂâµÂª∫ÊàêÂäüÔºÅ</h4>
                            <p><strong>Resource ID:</strong> ${result.resourceId}</p>
                            <p><strong>Type:</strong> ${result.details.type}</p>
                            <p><strong>Message:</strong> ${result.message}</p>
                            ${result.details.templateUrl ? `<p><a href="${result.details.templateUrl}" target="_blank">üìÑ Open Template</a></p>` : ''}
                            ${result.details.docUrl ? `<p><a href="${result.details.docUrl}" target="_blank">üìñ Open Documentation</a></p>` : ''}
                            ${result.details.configUrl ? `<p><a href="${result.details.configUrl}" target="_blank">‚öôÔ∏è Open Configuration</a></p>` : ''}
                        `;
                        
                        // Clear form
                        document.getElementById('resourceName').value = '';
                        document.getElementById('resourceDescription').value = '';
                        
                        showSuccess(`üéâ Resource "${name}" created successfully!\n\nResource ID: ${result.resourceId}`);
                    } else {
                        showError('‚ùå Failed to create resource: ' + (result.error || 'Unknown error'));
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('‚ùå Failed to create resource: ' + error.message);
                })
                .addNewResource(type, name, description, {});
        }

        function listExistingResources() {
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result.success) {
                        const resultDiv = document.getElementById('resourceResult');
                        resultDiv.style.display = 'block';
                        
                        let html = `<h4>üìã Existing Resources (${result.total}) | ÁèæÊúâË≥áÊ∫ê</h4>`;
                        if (result.resources.length === 0) {
                            html += '<p>No resources found | Êú™ÊâæÂà∞Ë≥áÊ∫ê</p>';
                        } else {
                            html += '<div style="max-height: 200px; overflow-y: auto;">';
                            result.resources.forEach(resource => {
                                html += `
                                    <div style="border: 1px solid #ddd; margin: 5px 0; padding: 10px; border-radius: 3px;">
                                        <strong>${resource.name}</strong> (${resource.type})
                                        <br><small>${resource.description}</small>
                                        <br><small>Created: ${new Date(resource.created).toLocaleDateString()}</small>
                                    </div>
                                `;
                            });
                            html += '</div>';
                        }
                        
                        resultDiv.innerHTML = html;
                    } else {
                        showError('‚ùå Failed to list resources: ' + (result.error || 'Unknown error'));
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('‚ùå Failed to list resources: ' + error.message);
                })
                .listProjectResources();
        }

        function showModal(title, content) {
            // Create modal overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.5); z-index: 1000; display: flex;
                align-items: center; justify-content: center;
            `;
            
            // Create modal content
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: white; border-radius: 10px; max-width: 600px;
                max-height: 80vh; overflow-y: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            `;
            
            modal.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-bottom: 1px solid #eee;">
                    <h3 style="margin: 0;">${title}</h3>
                    <button onclick="this.closest('.modal-overlay').remove()" 
                            style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                </div>
                <div>${content}</div>
            `;
            
            overlay.className = 'modal-overlay';
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
            
            // Close on overlay click
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) {
                    overlay.remove();
                }
            });
        }

        function updateTeachers() {
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    showSuccess('‚úÖ Teachers updated successfully! Found ' + result.length + ' teachers');
                    loadSystemStatistics();
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('‚ùå Failed to update teachers: ' + error.message);
                })
                .updateAutoGeneratedTeachers();
        }

        function updateStudentStatus() {
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    showSuccess('‚úÖ Student status updated successfully!');
                    loadSystemStatistics();
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('‚ùå Failed to update student status: ' + error.message);
                })
                .updateStudentStatus();
        }

        function debugSystem() {
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    let studentSamplesText = '';
                    if (result.studentSamples && result.studentSamples.length > 0) {
                        studentSamplesText = result.studentSamples.map(s => 
                            `‚Ä¢ ${s.name || 'empty'} (Status: ${s.status || 'empty'}, Class: ${s.englishClass || 'empty'}, LT: ${s.ltTeacher || 'empty'}, IT: ${s.itTeacher || 'empty'})`
                        ).join('\n');
                    }
                    
                    let teacherSamplesText = '';
                    if (result.teacherSamples && result.teacherSamples.length > 0) {
                        teacherSamplesText = result.teacherSamples.map(t => 
                            `‚Ä¢ ${t.name} (${t.subject}) - Classes: ${t.classes}`
                        ).join('\n');
                    }
                    
                    const debugInfo = `
üîç System Debug Results:

üìÅ System Folder: ${result.systemFolder}
üìã Master Data Sheet: ${result.masterDataSheet}  
üë• Students Data: ${result.studentsData} total records
üìù Students with "Âú®Â≠∏" status: ${result.studentsWithStatus}
üë®‚Äçüè´ Teachers Found: ${result.teachersFound}
üìä Gradebooks Folder: ${result.teacherGradebooksFolder}

üìÑ Student Samples (first 5):
${studentSamplesText || 'No student data found'}

üë©‚Äçüè´ Teacher Samples:
${teacherSamplesText || 'No teacher data found'}

${result.error ? '‚ùå Error: ' + result.error : '‚úÖ No errors detected'}
                    `;
                    showSuccess(debugInfo);
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('‚ùå Debug failed: ' + error.message);
                })
                .debugSystemStatus();
        }

        function checkHeaders() {
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    let headersText = '';
                    if (result.headers) {
                        headersText = result.headers.map((header, index) => 
                            `${index + 1}. "${header}"`
                        ).join('\n');
                    }
                    
                    let indicesText = '';
                    if (result.columnIndices) {
                        indicesText = Object.entries(result.columnIndices).map(([col, index]) => 
                            `"${col}": ${index === -1 ? 'NOT FOUND' : 'Column ' + (index + 1)}`
                        ).join('\n');
                    }
                    
                    let sampleRowText = '';
                    if (result.sampleRow) {
                        sampleRowText = result.sampleRow.map((value, index) => 
                            `${index + 1}. ${value || 'empty'}`
                        ).join('\n');
                    }
                    
                    const headerInfo = `
üìã Column Headers Check:

üìä Total Columns: ${result.columnCount}
üìÑ Data Rows: ${result.dataRows}

üîç All Headers:
${headersText}

üéØ Key Column Indices:
${indicesText}

üìù Sample Row Data:
${sampleRowText}

${result.error ? '‚ùå Error: ' + result.error : '‚úÖ Headers checked successfully'}
                    `;
                    showSuccess(headerInfo);
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('‚ùå Header check failed: ' + error.message);
                })
                .checkColumnHeaders();
        }

        function testCreation() {
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result.error) {
                        showError('‚ùå Test failed: ' + result.error);
                        return;
                    }
                    
                    let assignmentText = '';
                    if (result && result.length > 0) {
                        assignmentText = result.map(assignment => 
                            `üè´ ${assignment.teacher} (${assignment.subject})
   üìö Class: ${assignment.class}
   üë• Students (${assignment.studentCount}): ${assignment.studentNames.join(', ')}`
                        ).join('\n\n');
                    }
                    
                    const testInfo = `
üß™ Gradebook Creation Test:

${assignmentText || 'No valid assignments found'}

${result.length === 0 ? '‚ö†Ô∏è No students were assigned to any teachers!' : '‚úÖ Student assignments look correct!'}
                    `;
                    showSuccess(testInfo);
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('‚ùå Test failed: ' + error.message);
                })
                .testGradebookCreation();
        }

        function validateClassAssignments() {
            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result.isValid) {
                        showSuccess(`‚úÖ Class assignments validation passed!\n\nDefined classes: ${result.definedClasses.length}\nNo assignment conflicts found.`);
                    } else {
                        let message = `‚ö†Ô∏è Class assignment validation issues found:\n\n`;
                        message += `Issues (${result.issues.length}):\n`;
                        result.issues.slice(0, 10).forEach(issue => {
                            message += `‚Ä¢ ${issue}\n`;
                        });
                        if (result.issues.length > 10) {
                            message += `‚Ä¢ ... and ${result.issues.length - 10} more issues\n`;
                        }
                        message += `\nUndefined classes: ${result.undefinedClasses.join(', ')}\n`;
                        message += `\nPlease update Students sheet to match Classes sheet definitions.`;
                        showError(message);
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('‚ùå Validation failed: ' + error.message);
                })
                .validateStudentClassAssignments();
        }

        function systemMaintenance() {
            showSuccess('üîß Maintenance feature coming soon!');
        }

        // Assessment Title Management Functions
        function manageAssessmentTitles() {
            document.getElementById('assessmentModal').style.display = 'block';
            loadAssessmentTitles();
        }

        function closeAssessmentModal() {
            document.getElementById('assessmentModal').style.display = 'none';
        }

        function loadAssessmentTitles() {
            const content = document.getElementById('assessment-content');
            content.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div class="spinner"></div>
                    <p>Loading level configurations...</p>
                </div>
            `;

            // Load assessment titles by levels instead of classes
            renderAssessmentLevels();
        }

        function renderAssessmentLevels() {
            const content = document.getElementById('assessment-content');
            
            // Define all available levels based on system configuration
            const levels = [
                // Grade 1 Levels
                { level: 'G1E1', grade: 'Grade 1' },
                { level: 'G1E2', grade: 'Grade 1' },
                { level: 'G1E3', grade: 'Grade 1' },
                
                // Grade 2 Levels
                { level: 'G2E1', grade: 'Grade 2' },
                { level: 'G2E2', grade: 'Grade 2' },
                { level: 'G2E3', grade: 'Grade 2' },
                
                // Grade 3 Levels
                { level: 'G3E1', grade: 'Grade 3' },
                { level: 'G3E2', grade: 'Grade 3' },
                { level: 'G3E3', grade: 'Grade 3' },
                
                // Grade 4 Levels
                { level: 'G4E1', grade: 'Grade 4' },
                { level: 'G4E2', grade: 'Grade 4' },
                { level: 'G4E3', grade: 'Grade 4' },
                
                // Grade 5 Levels
                { level: 'G5E1', grade: 'Grade 5' },
                { level: 'G5E2', grade: 'Grade 5' },
                { level: 'G5E3', grade: 'Grade 5' },
                
                // Grade 6 Levels
                { level: 'G6E1', grade: 'Grade 6' },
                { level: 'G6E2', grade: 'Grade 6' },
                { level: 'G6E3', grade: 'Grade 6' },
                { level: 'G6', grade: 'Grade 6' }
            ];

            let html = `
                <div style="margin-bottom: 30px; padding: 20px; background: #e3f2fd; border-radius: 10px;">
                    <h3 style="margin: 0 0 10px 0; color: #1976d2;">
                        <i class="fas fa-info-circle"></i> Level-Based Assessment Title Management
                    </h3>
                    <ul style="margin: 0; padding-left: 20px; color: #555;">
                        <li>Manage assessment titles by educational levels (G1E1, G1E2, etc.)</li>
                        <li>Each level has separate sections for LT (Local Teacher) and IT (International Teacher)</li>
                        <li>Modify assessment titles below and click "Update" to save changes</li>
                        <li>Click "Reset" to restore default titles (F.A.1-F.A.8, S.A.1-S.A.4)</li>
                        <li>Changes will be synced to all existing gradebooks using this level</li>
                    </ul>
                </div>
            `;

            // Group by grade
            const groupedLevels = {};
            levels.forEach(levelConfig => {
                if (!groupedLevels[levelConfig.grade]) {
                    groupedLevels[levelConfig.grade] = [];
                }
                groupedLevels[levelConfig.grade].push(levelConfig);
            });

            // Render each grade
            Object.keys(groupedLevels).sort().forEach(grade => {
                html += `<h3 style="margin: 30px 0 20px 0; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                    <i class="fas fa-graduation-cap"></i> ${grade} Levels
                </h3>`;

                groupedLevels[grade].forEach(levelConfig => {
                    html += createLevelCard(levelConfig);
                });
            });

            content.innerHTML = html;
        }

        function createLevelCard(levelConfig) {
            // Get default titles for both LT and IT
            const defaultTitles = {
                formative: ['F.A.1', 'F.A.2', 'F.A.3', 'F.A.4', 'F.A.5', 'F.A.6', 'F.A.7', 'F.A.8'],
                summative: ['S.A.1', 'S.A.2', 'S.A.3', 'S.A.4']
            };
            
            return `
                <div class="class-card">
                    <div class="class-header">
                        <div class="class-info">
                            <h3>${levelConfig.level}</h3>
                            <p><strong>Grade:</strong> ${levelConfig.grade}</p>
                        </div>
                    </div>
                    
                    <!-- LT Section -->
                    <div style="border: 2px solid #ff9800; border-radius: 10px; padding: 15px; margin-bottom: 20px; background: #fff3e0;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="margin: 0; color: #f57c00;">
                                <i class="fas fa-user-tie" style="margin-right: 8px;"></i>
                                LT (Local Teacher)
                            </h4>
                            <div>
                                <button class="btn-update" onclick="updateLevelAssessmentTitles('${levelConfig.level}', 'LT')" style="margin-right: 5px;">
                                    <i class="fas fa-save"></i> Update LT
                                </button>
                                <button class="btn-reset" onclick="resetLevelAssessmentTitles('${levelConfig.level}', 'LT')">
                                    <i class="fas fa-undo"></i> Reset LT
                                </button>
                            </div>
                        </div>
                        
                        <div class="assessment-section">
                            <h5><i class="fas fa-pencil-alt" style="color: #2196f3;"></i> Formative Assessments (8 items)</h5>
                            <div class="assessment-grid">
                                ${defaultTitles.formative.map((title, index) => 
                                    `<input type="text" class="assessment-input" 
                                            id="formative-${levelConfig.level}-LT-${index}" 
                                            value="${title}" 
                                            placeholder="F.A.${index + 1}">`
                                ).join('')}
                            </div>
                        </div>
                        
                        <div class="assessment-section">
                            <h5><i class="fas fa-chart-bar" style="color: #4caf50;"></i> Summative Assessments (4 items)</h5>
                            <div class="assessment-grid">
                                ${defaultTitles.summative.map((title, index) => 
                                    `<input type="text" class="assessment-input" 
                                            id="summative-${levelConfig.level}-LT-${index}" 
                                            value="${title}" 
                                            placeholder="S.A.${index + 1}">`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <!-- IT Section -->
                    <div style="border: 2px solid #2196f3; border-radius: 10px; padding: 15px; background: #e3f2fd;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="margin: 0; color: #1976d2;">
                                <i class="fas fa-globe" style="margin-right: 8px;"></i>
                                IT (International Teacher)
                            </h4>
                            <div>
                                <button class="btn-update" onclick="updateLevelAssessmentTitles('${levelConfig.level}', 'IT')" style="margin-right: 5px;">
                                    <i class="fas fa-save"></i> Update IT
                                </button>
                                <button class="btn-reset" onclick="resetLevelAssessmentTitles('${levelConfig.level}', 'IT')">
                                    <i class="fas fa-undo"></i> Reset IT
                                </button>
                            </div>
                        </div>
                        
                        <div class="assessment-section">
                            <h5><i class="fas fa-pencil-alt" style="color: #2196f3;"></i> Formative Assessments (8 items)</h5>
                            <div class="assessment-grid">
                                ${defaultTitles.formative.map((title, index) => 
                                    `<input type="text" class="assessment-input" 
                                            id="formative-${levelConfig.level}-IT-${index}" 
                                            value="${title}" 
                                            placeholder="F.A.${index + 1}">`
                                ).join('')}
                            </div>
                        </div>
                        
                        <div class="assessment-section">
                            <h5><i class="fas fa-chart-bar" style="color: #4caf50;"></i> Summative Assessments (4 items)</h5>
                            <div class="assessment-grid">
                                ${defaultTitles.summative.map((title, index) => 
                                    `<input type="text" class="assessment-input" 
                                            id="summative-${levelConfig.level}-IT-${index}" 
                                            value="${title}" 
                                            placeholder="S.A.${index + 1}">`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }


        function updateLevelAssessmentTitles(level, teacherType) {
            // Collect formative titles
            const formativeTitles = [];
            for (let i = 0; i < 8; i++) {
                const input = document.getElementById(`formative-${level}-${teacherType}-${i}`);
                formativeTitles.push(input ? input.value.trim() : `F.A.${i + 1}`);
            }

            // Collect summative titles
            const summativeTitles = [];
            for (let i = 0; i < 4; i++) {
                const input = document.getElementById(`summative-${level}-${teacherType}-${i}`);
                summativeTitles.push(input ? input.value.trim() : `S.A.${i + 1}`);
            }

            // Validate inputs
            if (formativeTitles.some(title => !title) || summativeTitles.some(title => !title)) {
                showError('‚ùå All fields must be filled');
                return;
            }

            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result.success) {
                        let message = `‚úÖ ${result.message}`;
                        if (result.sheetsUpdated) {
                            message += `\nüìä Updated ${result.sheetsUpdated} gradebook sheets`;
                        }
                        if (result.warnings && result.warnings.length > 0) {
                            message += `\n‚ö†Ô∏è Some issues occurred during synchronization:\n${result.warnings.join('\n')}`;
                        }
                        showSuccess(message);
                    } else {
                        showError(`‚ùå Failed to update ${level}: ${result.message}`);
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('‚ùå Update failed: ' + error.message);
                })
                .syncAssessmentTitlesByLevel(level, teacherType, formativeTitles, summativeTitles);
        }

        function resetLevelAssessmentTitles(level, teacherType) {
            if (!confirm(`Are you sure you want to reset assessment titles for ${level}? This will restore default titles and sync to all gradebooks using this level.`)) {
                return;
            }

            showLoading();
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result.success) {
                        let message = `‚úÖ ${result.message}`;
                        if (result.sheetsUpdated) {
                            message += `\nüìä Updated ${result.sheetsUpdated} gradebook sheets`;
                        }
                        if (result.warnings && result.warnings.length > 0) {
                            message += `\n‚ö†Ô∏è Some issues occurred during synchronization:\n${result.warnings.join('\n')}`;
                        }
                        showSuccess(message);
                        loadAssessmentTitles(); // Reload to show default titles
                    } else {
                        showError(`‚ùå Failed to reset ${level}: ${result.message}`);
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError('‚ùå Reset failed: ' + error.message);
                })
                .resetAssessmentTitlesByLevel(level, teacherType);
        }

        // Assessment Title Manager Functions
        function openAssessmentTitleManager() {
            document.getElementById('assessmentModal').style.display = 'block';
            resetAssessmentForm();
        }
        
        function closeAssessmentModal() {
            document.getElementById('assessmentModal').style.display = 'none';
            resetAssessmentForm();
        }
        
        function resetAssessmentForm() {
            document.getElementById('classSelect').value = '';
            document.querySelectorAll('input[name="subject"]').forEach(radio => radio.checked = false);
            document.getElementById('assessmentSelect').value = '';
            document.getElementById('newTitle').value = '';
            hideAssessmentResult();
        }
        
        function updateAssessmentTitle() {
            // Get form values
            const className = document.getElementById('classSelect').value;
            const subjectRadios = document.querySelectorAll('input[name="subject"]:checked');
            const assessmentCode = document.getElementById('assessmentSelect').value;
            const newTitle = document.getElementById('newTitle').value.trim();
            
            // Validation
            if (!className) {
                showAssessmentError('Please select a class | Ë´ãÈÅ∏ÊìáÁè≠Á¥ö');
                return;
            }
            
            if (subjectRadios.length === 0) {
                showAssessmentError('Please select a subject | Ë´ãÈÅ∏ÊìáÁßëÁõÆ');
                return;
            }
            
            const subjectType = subjectRadios[0].value;
            
            if (!assessmentCode) {
                showAssessmentError('Please select an assessment | Ë´ãÈÅ∏ÊìáË©ïÈáè');
                return;
            }
            
            if (!newTitle) {
                showAssessmentError('Please enter a new title | Ë´ãËº∏ÂÖ•Êñ∞Ê®ôÈ°å');
                return;
            }
            
            // Show loading
            showAssessmentResult('üîÑ Updating assessment title... | Ê≠£Âú®Êõ¥Êñ∞Ë©ïÈáèÊ®ôÈ°å...', 'loading');
            
            // Call the backend function
            google.script.run
                .withSuccessHandler(function(result) {
                    if (result.success) {
                        showAssessmentResult(
                            `‚úÖ Successfully updated! | Êõ¥Êñ∞ÊàêÂäüÔºÅ<br><br>` +
                            `<strong>Class | Áè≠Á¥ö:</strong> ${className}<br>` +
                            `<strong>Subject | ÁßëÁõÆ:</strong> ${subjectType}<br>` +
                            `<strong>Assessment | Ë©ïÈáè:</strong> ${assessmentCode}<br>` +
                            `<strong>New Title | Êñ∞Ê®ôÈ°å:</strong> ${newTitle}<br><br>` +
                            `<strong>Updated Teachers | Â∑≤Êõ¥Êñ∞ÁöÑËÄÅÂ∏´:</strong><br>` +
                            `${result.details || 'Update completed successfully | Êõ¥Êñ∞ÂÆåÊàê'}`,
                            'success'
                        );
                    } else {
                        showAssessmentResult(`‚ùå Error | ÈåØË™§: ${result.error}`, 'error');
                    }
                })
                .withFailureHandler(function(error) {
                    showAssessmentResult(`‚ùå System error | Á≥ªÁµ±ÈåØË™§: ${error.message}`, 'error');
                })
                .updateSingleClassAssessment(className, subjectType, assessmentCode, newTitle);
        }
        
        function showAssessmentResult(message, type) {
            const resultDiv = document.getElementById('assessment-result');
            resultDiv.innerHTML = message;
            resultDiv.className = 'result-section';
            
            if (type === 'success') {
                resultDiv.classList.add('result-success');
            } else if (type === 'error') {
                resultDiv.classList.add('result-error');
            }
            
            resultDiv.style.display = 'block';
        }
        
        function showAssessmentError(message) {
            showAssessmentResult(message, 'error');
        }
        
        function hideAssessmentResult() {
            document.getElementById('assessment-result').style.display = 'none';
        }
        
        // ===== PROGRESS AUDIT FUNCTIONS | ÈÄ≤Â∫¶Á®ΩÊ†∏ÂáΩÊï∏ =====
        
        // Open Progress Audit Modal
        function openProgressAudit() {
            document.getElementById('progressAuditModal').style.display = 'block';
            resetProgressAuditForm();
            // Default to G1 tab
            switchProgressTab('G1');
        }
        
        // Run Comparison Dashboard Diagnosis
        function runComparisonDashboardDiagnosis() {
            showLoading();
            showSuccess('üîç Starting comprehensive diagnosis... | ÈñãÂßãÁ∂úÂêàË®∫Êñ∑...', 3000);
            
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    
                    if (result.success) {
                        const summary = result.summary;
                        // Format diagnosis info as HTML for better modal display
                        const diagnosisInfo = `
<div style="font-family: monospace; line-height: 1.6; white-space: pre-wrap;">üîç <strong>Comparison Dashboard Diagnosis Results | ÊØîËºÉÈù¢ÊùøË®∫Êñ∑ÁµêÊûú</strong>
===========================================================

üìä <strong>SUMMARY | ÊëòË¶Å:</strong>
‚Ä¢ Gradebook Files Found | ÊâæÂà∞ÊàêÁ∏æÁ∞øÊ™îÊ°à: <span style="color: ${summary.gradebookFilesFound > 0 ? 'green' : 'red'}; font-weight: bold;">${summary.gradebookFilesFound}</span>
‚Ä¢ Total Teachers | Á∏ΩÊïôÂ∏´Êï∏: <span style="color: ${summary.totalTeachers > 0 ? 'green' : 'red'}; font-weight: bold;">${summary.totalTeachers}</span>
‚Ä¢ Total Classes | Á∏ΩÁè≠Á¥öÊï∏: <span style="color: ${summary.totalClasses > 0 ? (summary.totalClasses > 100 ? 'orange' : 'green') : 'red'}; font-weight: bold;">${summary.totalClasses}</span>
‚Ä¢ Has Errors | ÊúâÈåØË™§: <span style="color: ${summary.hasErrors ? 'red' : 'green'}; font-weight: bold;">${summary.hasErrors ? 'ÊòØ' : 'Âê¶'}</span>

üîß <strong>DIAGNOSIS DETAILS | Ë®∫Êñ∑Ë©≥ÊÉÖ:</strong>
‚Ä¢ Timestamp | ÊôÇÈñìÊà≥: ${result.diagnosis.timestamp}
‚Ä¢ Basic Data Check | Âü∫Êú¨Ë≥áÊñôÊ™¢Êü•: ${result.diagnosis.basicData ? (result.diagnosis.basicData.error ? '<span style="color: red;">‚ùå Failed</span>' : '<span style="color: green;">‚úÖ Passed</span>') : '<span style="color: orange;">‚ö†Ô∏è Skipped</span>'}
‚Ä¢ Gradebook Files | ÊàêÁ∏æÁ∞øÊ™îÊ°à: ${result.diagnosis.gradebookFiles ? (result.diagnosis.gradebookFiles.error ? '<span style="color: red;">‚ùå Failed</span>' : '<span style="color: green;">‚úÖ Found ' + result.diagnosis.gradebookFiles.count + ' files</span>') : '<span style="color: orange;">‚ö†Ô∏è Skipped</span>'}
‚Ä¢ Progress Data | ÈÄ≤Â∫¶Ë≥áÊñô: ${result.diagnosis.progressData ? (result.diagnosis.progressData.error ? '<span style="color: red;">‚ùå Failed</span>' : '<span style="color: green;">‚úÖ Analyzed</span>') : '<span style="color: orange;">‚ö†Ô∏è Skipped</span>'}
‚Ä¢ Worksheet Analysis | Â∑•‰ΩúË°®ÂàÜÊûê: ${result.diagnosis.worksheetAnalysis ? (result.diagnosis.worksheetAnalysis.error ? '<span style="color: red;">‚ùå Failed</span>' : '<span style="color: green;">‚úÖ Completed</span>') : '<span style="color: orange;">‚ö†Ô∏è Skipped</span>'}

üìù <strong>RECOMMENDATIONS | Âª∫Ë≠∞:</strong>
${summary.totalClasses === 168 && summary.totalClasses > 50 ? '<span style="color: orange;">‚ö†Ô∏è Class count seems abnormally high (168). Check worksheet filtering logic.</span>\n' : ''}${summary.gradebookFilesFound === 0 ? '<span style="color: red;">‚ùå No gradebook files found. Check file location and permissions.</span>\n' : ''}${summary.hasErrors ? '<span style="color: red;">‚ùå Errors detected. Check console logs for detailed error messages.</span>' : '<span style="color: green;">‚úÖ No major errors detected.</span>'}

===========================================================
üìã Check browser console (F12) for detailed logs
üìã Ê™¢Êü•ÁÄèË¶ΩÂô®ÊéßÂà∂Âè∞ (F12) ÂèñÂæóË©≥Á¥∞Êó•Ë™å</div>
`;
                        
                        showModal('üîç Comparison Dashboard Diagnosis | ÊØîËºÉÈù¢ÊùøË®∫Êñ∑', diagnosisInfo);
                        
                        // Also log structured data to console for debugging
                        console.log('üîç Structured Diagnosis Data:', result.diagnosis);
                        
                    } else {
                        showError(`‚ùå Diagnosis failed: ${result.error || 'Unknown error'}`);
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError(`‚ùå Diagnosis execution failed: ${error.message}`);
                    console.error('Diagnosis execution error:', error);
                })
                .diagnoseComparisonDashboardIssues();
        }
        
        // Debug Average Row Detection
        function debugAverageRowDetection() {
            showLoading();
            showSuccess('üî¨ Starting Average row detection debugging... | ÈñãÂßã Average Ë°åÊ™¢Ê∏¨Ë™øË©¶...', 3000);
            
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    
                    if (result.success) {
                        const summary = result.summary;
                        const debugInfo = `
<div style="font-family: monospace; line-height: 1.6; white-space: pre-wrap;">üî¨ <strong>Average Row Detection Debug Results | Average Ë°åÊ™¢Ê∏¨Ë™øË©¶ÁµêÊûú</strong>
===========================================================

üìä <strong>SUMMARY | ÊëòË¶Å:</strong>
‚Ä¢ Total Sheets Analyzed | ÂàÜÊûêÁöÑÂ∑•‰ΩúË°®Á∏ΩÊï∏: <span style="color: blue; font-weight: bold;">${summary.totalAnalyzed}</span>
‚Ä¢ Success Rate | ÊàêÂäüÁéá: <span style="color: ${summary.successRate > 80 ? 'green' : summary.successRate > 50 ? 'orange' : 'red'}; font-weight: bold;">${summary.successRate}%</span>
‚Ä¢ Most Successful Method | ÊúÄÊàêÂäüÁöÑÊñπÊ≥ï: <span style="color: green; font-weight: bold;">${summary.mostSuccessfulMethod}</span>

üîß <strong>DETECTION METHODS PERFORMANCE | Ê™¢Ê∏¨ÊñπÊ≥ïË°®Áèæ:</strong>
‚Ä¢ Method 1 (Text Search) | ÊñáÂ≠óÊêúÂ∞ã: <span style="color: ${result.debugResults.detectionMethods.method1_textSearch > 0 ? 'green' : 'red'}; font-weight: bold;">${result.debugResults.detectionMethods.method1_textSearch}</span>
‚Ä¢ Method 2 (Last Data Row) | ÊúÄÂæåÊï∏ÊìöË°å: <span style="color: ${result.debugResults.detectionMethods.method2_lastDataRow > 0 ? 'green' : 'red'}; font-weight: bold;">${result.debugResults.detectionMethods.method2_lastDataRow}</span>
‚Ä¢ Method 3 (Calculated Position) | Ë®àÁÆó‰ΩçÁΩÆ: <span style="color: ${result.debugResults.detectionMethods.method3_calculatedPosition > 0 ? 'green' : 'red'}; font-weight: bold;">${result.debugResults.detectionMethods.method3_calculatedPosition}</span>
‚Ä¢ None Worked | ÁÑ°ÊñπÊ≥ïÊàêÂäü: <span style="color: ${result.debugResults.detectionMethods.none > 0 ? 'red' : 'green'}; font-weight: bold;">${result.debugResults.detectionMethods.none}</span>

üìà <strong>DETAILED ANALYSIS | Ë©≥Á¥∞ÂàÜÊûê:</strong>
‚Ä¢ Gradebooks Analyzed | ÂàÜÊûêÁöÑÊàêÁ∏æÁ∞ø: ${result.debugResults.analyzedGradebooks}
‚Ä¢ Total Sheets Analyzed | Á∏ΩÂ∑•‰ΩúË°®Êï∏: ${result.debugResults.totalSheetsAnalyzed}
‚Ä¢ Average Rows Found | ÊâæÂà∞ Average Ë°å: <span style="color: green;">${result.debugResults.averageRowFound}</span>
‚Ä¢ Average Rows Not Found | Êú™ÊâæÂà∞ Average Ë°å: <span style="color: red;">${result.debugResults.averageRowNotFound}</span>

${summary.successRate < 100 ? '<span style="color: orange;">‚ö†Ô∏è Some Average rows could not be detected. Check browser console (F12) for detailed analysis.</span>' : '<span style="color: green;">‚úÖ All Average rows detected successfully!</span>'}

===========================================================
üìã Check browser console (F12) for detailed sheet-by-sheet analysis
üìã Ê™¢Êü•ÁÄèË¶ΩÂô®ÊéßÂà∂Âè∞ (F12) ÂèñÂæóË©≥Á¥∞ÁöÑÂ∑•‰ΩúË°®ÈÄê‰∏ÄÂàÜÊûê</div>
`;
                        
                        showModal('üî¨ Average Row Detection Debug | Average Ë°åÊ™¢Ê∏¨Ë™øË©¶', debugInfo);
                        
                        // Also log detailed results to console for debugging
                        console.log('üî¨ Detailed Average Row Detection Results:', result.debugResults);
                        
                    } else {
                        showError(`‚ùå Average row debugging failed: ${result.error || 'Unknown error'}`);
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError(`‚ùå Average row debugging execution failed: ${error.message}`);
                    console.error('Average row debugging execution error:', error);
                })
                .debugAverageRowDetection();
        }
        
        // Debug Average Row Data Extraction
        function debugAverageRowDataExtraction() {
            showLoading();
            showSuccess('üìä Starting data extraction debugging... | ÈñãÂßãÊï∏ÊìöÊèêÂèñË™øË©¶...', 3000);
            
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    
                    if (result.success) {
                        const summary = result.summary;
                        const debugInfo = `
<div style="font-family: monospace; line-height: 1.6; white-space: pre-wrap;">üìä <strong>Average Row Data Extraction Debug Results | Average Ë°åÊï∏ÊìöÊèêÂèñË™øË©¶ÁµêÊûú</strong>
===========================================================

üìä <strong>SUMMARY | ÊëòË¶Å:</strong>
‚Ä¢ Total Sheets Analyzed | ÂàÜÊûêÁöÑÂ∑•‰ΩúË°®Á∏ΩÊï∏: <span style="color: blue; font-weight: bold;">${summary.totalAnalyzed}</span>
‚Ä¢ Success Rate | ÊàêÂäüÁéá: <span style="color: ${summary.successRate > 80 ? 'green' : summary.successRate > 50 ? 'orange' : 'red'}; font-weight: bold;">${summary.successRate}%</span>
‚Ä¢ Valid Data Rate | ÊúâÊïàÊï∏ÊìöÁéá: <span style="color: ${summary.validDataRate > 80 ? 'green' : summary.validDataRate > 50 ? 'orange' : 'red'}; font-weight: bold;">${summary.validDataRate}%</span>
‚Ä¢ Zero Data Count | Èõ∂Êï∏ÊìöË®àÊï∏: <span style="color: ${summary.zeroDataCount > 0 ? 'red' : 'green'}; font-weight: bold;">${summary.zeroDataCount}</span>

üîß <strong>DETAILED ANALYSIS | Ë©≥Á¥∞ÂàÜÊûê:</strong>
‚Ä¢ Gradebooks Analyzed | ÂàÜÊûêÁöÑÊàêÁ∏æÁ∞ø: ${result.debugResults.analyzedGradebooks}
‚Ä¢ Total Sheets Analyzed | Á∏ΩÂ∑•‰ΩúË°®Êï∏: ${result.debugResults.totalSheetsAnalyzed}
‚Ä¢ Successful Extractions | ÊàêÂäüÊèêÂèñ: <span style="color: green;">${result.debugResults.successfulExtractions}</span>
‚Ä¢ Failed Extractions | Â§±ÊïóÊèêÂèñ: <span style="color: red;">${result.debugResults.failedExtractions}</span>
‚Ä¢ Zero Data Extractions | Èõ∂Êï∏ÊìöÊèêÂèñ: <span style="color: ${result.debugResults.zeroDataExtractions > 0 ? 'red' : 'green'};">${result.debugResults.zeroDataExtractions}</span>

üéØ <strong>MAIN ISSUE | ‰∏ªË¶ÅÂïèÈ°å:</strong>
<span style="color: ${summary.validDataRate < 50 ? 'red' : summary.validDataRate < 80 ? 'orange' : 'green'}; font-weight: bold;">${summary.mainIssue}</span>

${summary.validDataRate < 50 ? '<span style="color: red;">üö® CRITICAL: Most data extractions return zero values. Column positions in extractClassAveragesFromGradebook() may be incorrect.</span>' : ''}
${summary.validDataRate >= 50 && summary.validDataRate < 80 ? '<span style="color: orange;">‚ö†Ô∏è Some data extractions return zero values. Verify column mapping.</span>' : ''}
${summary.validDataRate >= 80 ? '<span style="color: green;">‚úÖ Data extraction is working well!</span>' : ''}

===========================================================
üìã Check browser console (F12) for detailed extraction data
üìã Ê™¢Êü•ÁÄèË¶ΩÂô®ÊéßÂà∂Âè∞ (F12) ÂèñÂæóË©≥Á¥∞ÁöÑÊèêÂèñÊï∏Êìö</div>
`;
                        
                        showModal('üìä Data Extraction Debug | Êï∏ÊìöÊèêÂèñË™øË©¶', debugInfo);
                        
                        // Also log detailed results to console for debugging
                        console.log('üìä Detailed Data Extraction Results:', result.debugResults);
                        
                    } else {
                        showError(`‚ùå Data extraction debugging failed: ${result.error || 'Unknown error'}`);
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError(`‚ùå Data extraction debugging execution failed: ${error.message}`);
                    console.error('Data extraction debugging execution error:', error);
                })
                .debugAverageRowDataExtraction();
        }
        
        // Debug Column Positions
        function debugColumnPositions() {
            showLoading();
            showSuccess('üîç Starting column position analysis... | ÈñãÂßãÂàó‰ΩçÁΩÆÂàÜÊûê...', 3000);
            
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    
                    if (result.success) {
                        showSuccess('‚úÖ Column position analysis completed successfully!');
                        
                        // Display detailed results
                        let html = '<div class="debug-results-container">';
                        html += '<h3>üîç Column Position Analysis Results | Âàó‰ΩçÁΩÆÂàÜÊûêÁµêÊûú</h3>';
                        
                        html += '<div class="debug-summary">';
                        html += `<p><strong>üìã Gradebooks Analyzed | ÂàÜÊûêÁöÑÊàêÁ∏æÁ∞ø:</strong> ${result.data.totalGradebooks}</p>`;
                        html += `<p><strong>üìä Analysis Summary | ÂàÜÊûêÊëòË¶Å:</strong></p>`;
                        html += '</div>';
                        
                        if (result.data.analysis && result.data.analysis.length > 0) {
                            result.data.analysis.forEach((gradebook, index) => {
                                html += `<div class="gradebook-analysis border p-3 mb-3">`;
                                html += `<h4>üìö ${gradebook.gradebookName}</h4>`;
                                
                                if (gradebook.headers) {
                                    html += `<h5>üìù Header Row Analysis | Ë°®È†≠Ë°åÂàÜÊûê</h5>`;
                                    html += `<div class="header-analysis">`;
                                    gradebook.headers.forEach((header, colIndex) => {
                                        const columnLetter = String.fromCharCode(65 + colIndex);
                                        html += `<span class="badge badge-secondary mr-1">${columnLetter}: ${header}</span>`;
                                    });
                                    html += `</div>`;
                                }
                                
                                if (gradebook.averageData) {
                                    html += `<h5 class="mt-3">üìä Average Row Data | Âπ≥ÂùáË°åÊï∏Êìö</h5>`;
                                    html += `<div class="average-data">`;
                                    gradebook.averageData.forEach((value, colIndex) => {
                                        const columnLetter = String.fromCharCode(65 + colIndex);
                                        const isNumeric = !isNaN(parseFloat(value)) && parseFloat(value) >= 0 && parseFloat(value) <= 100;
                                        const badgeClass = isNumeric ? 'badge-success' : 'badge-light';
                                        html += `<span class="badge ${badgeClass} mr-1">${columnLetter}: ${value}</span>`;
                                    });
                                    html += `</div>`;
                                }
                                
                                if (gradebook.potentialGradeColumns && gradebook.potentialGradeColumns.length > 0) {
                                    html += `<h5 class="mt-3">üéØ Potential Grade Columns | ÊΩõÂú®ÊàêÁ∏æÂàó</h5>`;
                                    html += `<div class="potential-columns">`;
                                    gradebook.potentialGradeColumns.forEach(col => {
                                        html += `<span class="badge badge-warning mr-1">Column ${col.column} (${col.letter}): ${col.value}</span>`;
                                    });
                                    html += `</div>`;
                                }
                                
                                html += `</div>`;
                            });
                        }
                        
                        if (result.data.recommendations) {
                            html += '<div class="recommendations mt-4 p-3 border-left border-primary bg-light">';
                            html += '<h4>üí° Recommendations | Âª∫Ë≠∞</h4>';
                            result.data.recommendations.forEach(rec => {
                                html += `<p>‚Ä¢ ${rec}</p>`;
                            });
                            html += '</div>';
                        }
                        
                        html += '</div>';
                        
                        document.getElementById('comparison-dashboard-container').innerHTML = html;
                    } else {
                        showError(`‚ùå Column position analysis failed: ${result.error}`);
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showError(`‚ùå Column position analysis execution failed: ${error.message}`);
                    console.error('Column position analysis execution error:', error);
                })
                .debugColumnPositions();
        }
        
        // Close Progress Audit Modal
        function closeProgressAuditModal() {
            document.getElementById('progressAuditModal').style.display = 'none';
            resetProgressAuditForm();
        }
        
        // Reset Progress Audit Form
        function resetProgressAuditForm() {
            // Reset checkpoint name
            document.getElementById('checkpointName').value = '';
            
            // Reset all checkboxes
            document.querySelectorAll('.progress-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // Clear results
            document.getElementById('progress-audit-results').innerHTML = '';
            document.getElementById('progress-audit-results').style.display = 'none';
        }
        
        // Switch between grade level tabs
        function switchProgressTab(grade) {
            // Update active tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content visibility
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById(`${grade}-tab`).style.display = 'block';
        }
        
        // Run Progress Audit
        function runProgressAudit() {
            const checkpointName = document.getElementById('checkpointName').value.trim();
            
            // Validation
            if (!checkpointName) {
                showProgressAuditError('Please enter a checkpoint name | Ë´ãËº∏ÂÖ•Ê™¢Êü•ÈªûÂêçÁ®±');
                return;
            }
            
            // Collect checkpoint configuration for all grades
            const checkpointConfig = {
                name: checkpointName,
                timestamp: new Date().toISOString(),
                requirements: {}
            };
            
            // Collect requirements for each grade level (G1-G6)
            const grades = ['G1', 'G2', 'G3', 'G4', 'G5', 'G6'];
            let hasAnyRequirements = false;
            
            grades.forEach(grade => {
                const levelGroups = [`${grade}E1`, `${grade}E2`, `${grade}E3`];
                
                levelGroups.forEach(levelGroup => {
                    const formativeRequirements = [];
                    const summativeRequirements = [];
                    
                    // Collect formative requirements (F.A.1 to F.A.8)
                    for (let i = 1; i <= 8; i++) {
                        const checkbox = document.getElementById(`fa-${levelGroup}-${i}`);
                        if (checkbox && checkbox.checked) {
                            formativeRequirements.push(`F.A.${i}`);
                        }
                    }
                    
                    // Collect summative requirements (S.A.1 to S.A.4)
                    for (let i = 1; i <= 4; i++) {
                        const checkbox = document.getElementById(`sa-${levelGroup}-${i}`);
                        if (checkbox && checkbox.checked) {
                            summativeRequirements.push(`S.A.${i}`);
                        }
                    }
                    
                    if (formativeRequirements.length > 0 || summativeRequirements.length > 0) {
                        checkpointConfig.requirements[levelGroup] = {
                            formative: formativeRequirements,
                            summative: summativeRequirements
                        };
                        hasAnyRequirements = true;
                    }
                });
            });
            
            if (!hasAnyRequirements) {
                showProgressAuditError('Please select at least one assessment requirement | Ë´ãËá≥Â∞ëÈÅ∏Êìá‰∏ÄÂÄãË©ïÈáèË¶ÅÊ±Ç');
                return;
            }
            
            // Show loading
            showProgressAuditLoading();
            
            // Call backend function
            google.script.run
                .withSuccessHandler(handleProgressAuditSuccess)
                .withFailureHandler(handleProgressAuditError)
                .performProgressAudit(checkpointConfig);
        }
        
        // Handle successful progress audit
        function handleProgressAuditSuccess(result) {
            hideProgressAuditLoading();
            
            if (result.success) {
                displayProgressAuditResults(result);
                showProgressAuditSuccess('Progress audit completed successfully | ÈÄ≤Â∫¶Á®ΩÊ†∏Â∑≤ÂÆåÊàê');
            } else {
                showProgressAuditError(`Audit failed: ${result.message} | Á®ΩÊ†∏Â§±ÊïóÔºö${result.message}`);
            }
        }
        
        // Handle progress audit error
        function handleProgressAuditError(error) {
            hideProgressAuditLoading();
            showProgressAuditError(`Audit error: ${error.message} | Á®ΩÊ†∏ÈåØË™§Ôºö${error.message}`);
        }
        
        // Display progress audit results
        function displayProgressAuditResults(result) {
            const resultsDiv = document.getElementById('progress-audit-results');
            
            let html = `
                <div class="progress-audit-summary">
                    <h4><i class="fas fa-chart-line"></i> Progress Audit Report | ÈÄ≤Â∫¶Á®ΩÊ†∏Â†±Âëä</h4>
                    <div class="audit-meta">
                        <p><strong>Checkpoint:</strong> ${result.checkpointName}</p>
                        <p><strong>Audit Date:</strong> ${new Date(result.timestamp).toLocaleString()}</p>
                        <p><strong>Teachers Analyzed:</strong> ${result.teacherCount}</p>
                        <p><strong>Overall Completion:</strong> ${result.overallCompletion}%</p>
                    </div>
                </div>
                
                <div class="progress-results-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Teacher | ÊïôÂ∏´</th>
                                <th>Level Groups | ÂàÜÁ¥ö</th>
                                <th>Formative | ÂΩ¢ÊàêÊÄß</th>
                                <th>Summative | Á∏ΩÁµêÊÄß</th>
                                <th>Overall | Êï¥È´î</th>
                                <th>Status | ÁãÄÊÖã</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            result.teacherResults.forEach(teacher => {
                const statusColor = teacher.overallCompletion >= 90 ? '#4caf50' : 
                                  teacher.overallCompletion >= 80 ? '#ff9800' : 
                                  teacher.overallCompletion >= 60 ? '#ff5722' : '#f44336';
                
                const statusIcon = teacher.overallCompletion >= 90 ? 'üü¢' : 
                                 teacher.overallCompletion >= 80 ? 'üü°' : 
                                 teacher.overallCompletion >= 60 ? 'üü†' : 'üî¥';
                
                html += `
                    <tr>
                        <td><strong>${teacher.name}</strong></td>
                        <td>${teacher.levelGroups.join(', ')}</td>
                        <td>${teacher.formativeCompletion}%</td>
                        <td>${teacher.summativeCompletion}%</td>
                        <td style="color: ${statusColor}; font-weight: bold;">${teacher.overallCompletion}%</td>
                        <td>${statusIcon}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            // Add detailed breakdown if available
            if (result.levelGroupBreakdown) {
                html += `
                    <div class="level-group-breakdown">
                        <h5><i class="fas fa-list-alt"></i> Level Group Breakdown | ÂàÜÁ¥öË©≥Á¥∞ÂàÜÊûê</h5>
                `;
                
                Object.entries(result.levelGroupBreakdown).forEach(([levelGroup, data]) => {
                    html += `
                        <div class="level-group-item">
                            <h6>${levelGroup}</h6>
                            <p>Completion: ${data.completion}% | Teachers: ${data.teacherCount}</p>
                        </div>
                    `;
                });
                
                html += `</div>`;
            }
            
            resultsDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
        }
        
        // Show progress audit loading
        function showProgressAuditLoading() {
            document.getElementById('progress-audit-loading').style.display = 'block';
        }
        
        // Hide progress audit loading
        function hideProgressAuditLoading() {
            document.getElementById('progress-audit-loading').style.display = 'none';
        }
        
        // Show progress audit success message
        function showProgressAuditSuccess(message) {
            showProgressAuditMessage(message, 'success');
        }
        
        // Show progress audit error message
        function showProgressAuditError(message) {
            showProgressAuditMessage(message, 'error');
        }
        
        // Show progress audit message
        function showProgressAuditMessage(message, type) {
            const messageDiv = document.getElementById('progress-audit-message');
            messageDiv.textContent = message;
            messageDiv.className = `progress-audit-message ${type}`;
            messageDiv.style.display = 'block';
            
            // Auto-hide after 5 seconds for success messages
            if (type === 'success') {
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 5000);
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const assessmentModal = document.getElementById('assessmentModal');
            const progressModal = document.getElementById('progressAuditModal');
            
            if (event.target === assessmentModal) {
                closeAssessmentModal();
            } else if (event.target === progressModal) {
                closeProgressAuditModal();
            }
        }

        // ===== COMPARISON DASHBOARD FUNCTIONS =====
        
        // Global variables for comparison dashboard
        let comparisonData = [];
        let filteredData = [];
        
        // Dashboard navigation function
        function switchToDashboard(dashboardType) {
            const mainDashboard = document.querySelector('.dashboard-grid');
            const comparisonDashboard = document.getElementById('comparison-dashboard');
            const btnMain = document.getElementById('btn-main-dashboard');
            const btnComparison = document.getElementById('btn-comparison-dashboard');
            
            if (dashboardType === 'main') {
                // Show main dashboard
                mainDashboard.style.display = 'grid';
                comparisonDashboard.style.display = 'none';
                btnMain.classList.add('active');
                btnComparison.classList.remove('active');
            } else if (dashboardType === 'comparison') {
                // Show comparison dashboard
                mainDashboard.style.display = 'none';
                comparisonDashboard.style.display = 'block';
                btnMain.classList.remove('active');
                btnComparison.classList.add('active');
                
                // Auto-load comparison data when switching to comparison dashboard
                if (comparisonData.length === 0) {
                    loadComparisonData();
                }
            }
        }
        
        // Load comparison data from backend
        function loadComparisonData() {
            // Show loading indicator
            document.getElementById('comparison-loading').style.display = 'block';
            document.getElementById('comparison-results').style.display = 'none';
            
            // Call backend function to get comparison data
            google.script.run
                .withSuccessHandler(function(result) {
                    document.getElementById('comparison-loading').style.display = 'none';
                    
                    if (result.success) {
                        comparisonData = result.data || [];
                        filteredData = [...comparisonData];
                        
                        // Update summary statistics
                        updateSummaryStatistics(result.summary);
                        
                        // Display comparison table
                        displayComparisonTable(filteredData);
                        
                        // Show results
                        document.getElementById('comparison-results').style.display = 'block';
                        
                        showSuccess('ÊØîËºÉË≥áÊñôËºâÂÖ•ÊàêÂäü | Comparison data loaded successfully');
                    } else {
                        showError('ËºâÂÖ•ÊØîËºÉË≥áÊñôÂ§±Êïó | Failed to load comparison data: ' + (result.error || 'Unknown error'));
                    }
                })
                .withFailureHandler(function(error) {
                    document.getElementById('comparison-loading').style.display = 'none';
                    showError('ËºâÂÖ•ÊØîËºÉË≥áÊñôÂ§±Êïó | Failed to load comparison data: ' + error.message);
                })
                .getComparisonDataForDashboard('grade-overview', null);
        }
        
        // Update summary statistics display
        function updateSummaryStatistics(summary) {
            if (!summary) return;
            
            document.getElementById('total-classes').textContent = summary.totalClasses || '0';
            document.getElementById('total-students').textContent = summary.totalStudents || '0';
            document.getElementById('avg-class-size').textContent = 
                summary.averageClassSize ? Math.round(summary.averageClassSize * 10) / 10 : '0';
            document.getElementById('system-average').textContent = 
                summary.systemAverage ? Math.round(summary.systemAverage * 10) / 10 + '%' : '0%';
        }
        
        // Display comparison table
        function displayComparisonTable(data) {
            const tableBody = document.getElementById('comparison-table-body');
            tableBody.innerHTML = '';
            
            if (!data || data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #6c757d; font-style: italic;">No data available | ÁÑ°Ë≥áÊñôÂèØÈ°ØÁ§∫</td></tr>';
                return;
            }
            
            data.forEach(classData => {
                const row = document.createElement('tr');
                
                // Determine status class and text
                const status = getStatusInfo(classData.averages.termGrade);
                
                // Create grade level tag
                const gradeLevel = classData.gradeLevel || 'Unknown';
                const gradeLevelTag = `<span class="grade-level-tag ${gradeLevel.toLowerCase()}">${gradeLevel}</span>`;
                
                row.innerHTML = `
                    <td><strong>${classData.className}</strong></td>
                    <td>${gradeLevelTag}</td>
                    <td>${classData.studentCount || 0}</td>
                    <td><strong>${formatPercentage(classData.averages.termGrade)}</strong></td>
                    <td>${formatPercentage(classData.averages.formativeAverage)}</td>
                    <td>${formatPercentage(classData.averages.summativeAverage)}</td>
                    <td>${formatPercentage(classData.averages.finalAssessment)}</td>
                    <td><span class="${status.className}">${status.text}</span></td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // Get status information for a grade
        function getStatusInfo(grade) {
            if (grade == null || isNaN(grade)) {
                return { className: 'status-normal', text: 'No Data | ÁÑ°Ë≥áÊñô' };
            }
            
            if (grade >= 90) {
                return { className: 'status-excellent', text: 'üü¢ Excellent | ÂÑ™Áï∞' };
            } else if (grade >= 80) {
                return { className: 'status-good', text: 'üü° Good | ËâØÂ•Ω' };
            } else if (grade >= 60) {
                return { className: 'status-normal', text: 'üü† Normal | ‰∏ÄËà¨' };
            } else {
                return { className: 'status-behind', text: 'üî¥ Behind | ËêΩÂæå' };
            }
        }
        
        // Format percentage with null check
        function formatPercentage(value) {
            if (value == null || isNaN(value)) {
                return 'N/A';
            }
            return Math.round(value * 10) / 10 + '%';
        }
        
        // Filter data by grade level
        function filterByGradeLevel() {
            const filter = document.getElementById('grade-level-filter').value;
            
            if (filter === 'all') {
                filteredData = [...comparisonData];
            } else {
                filteredData = comparisonData.filter(classData => 
                    classData.gradeLevel && classData.gradeLevel.toLowerCase().startsWith(filter.toLowerCase())
                );
            }
            
            // Reapply current sort
            sortComparisonData();
        }
        
        // Sort comparison data
        function sortComparisonData() {
            const sortMethod = document.getElementById('sort-method').value;
            
            filteredData.sort((a, b) => {
                switch (sortMethod) {
                    case 'class-name':
                        return (a.className || '').localeCompare(b.className || '');
                    
                    case 'term-grade':
                        const gradeA = a.averages.termGrade || 0;
                        const gradeB = b.averages.termGrade || 0;
                        return gradeB - gradeA; // Descending order
                    
                    case 'formative':
                        const formA = a.averages.formativeAverage || 0;
                        const formB = b.averages.formativeAverage || 0;
                        return formB - formA; // Descending order
                    
                    case 'summative':
                        const summA = a.averages.summativeAverage || 0;
                        const summB = b.averages.summativeAverage || 0;
                        return summB - summA; // Descending order
                    
                    case 'student-count':
                        const countA = a.studentCount || 0;
                        const countB = b.studentCount || 0;
                        return countB - countA; // Descending order
                    
                    default:
                        return 0;
                }
            });
            
            // Refresh the table display
            displayComparisonTable(filteredData);
        }


    </script>
</body>
</html>