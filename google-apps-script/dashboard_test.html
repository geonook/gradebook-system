<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Dashboard | æ¸¬è©¦æ§åˆ¶å°</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px;
            background: #f5f5f5;
        }
        .btn { 
            padding: 10px 20px; 
            margin: 10px; 
            background: #007bff; 
            color: white; 
            border: none; 
            border-radius: 5px;
            cursor: pointer;
        }
        .btn:hover { background: #0056b3; }
        .alert { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
            display: none;
        }
        .alert-success { background: #d4edda; color: #155724; }
        .alert-danger { background: #f8d7da; color: #721c24; }
        #loading { display: none; }
    </style>
</head>
<body>
    <h1>ğŸ§ª æ¸¬è©¦æ§åˆ¶å° | Test Dashboard</h1>
    
    <div id="loading">â³ è¼‰å…¥ä¸­...</div>
    <div id="alert-success" class="alert alert-success"></div>
    <div id="alert-danger" class="alert alert-danger"></div>
    
    <div>
        <h2>åŸºæœ¬åŠŸèƒ½æ¸¬è©¦ | Basic Function Tests</h2>
        <button class="btn" onclick="testConnection()">æ¸¬è©¦é€£æ¥ | Test Connection</button>
        <button class="btn" onclick="testInitialize()">æ¸¬è©¦åˆå§‹åŒ– | Test Initialize</button>
        <button class="btn" onclick="testBatchCreate()">æ¸¬è©¦æ‰¹é‡å»ºç«‹ | Test Batch Create</button>
        <button class="btn" onclick="openProgressAudit()">é€²åº¦ç¨½æ ¸ | Progress Audit</button>
    </div>

    <script>
        console.log('ğŸ§ª Test dashboard loading...');

        // Basic utility functions
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showSuccess(message) {
            const alert = document.getElementById('alert-success');
            alert.textContent = message;
            alert.style.display = 'block';
            hideError();
        }

        function showError(message) {
            const alert = document.getElementById('alert-danger');
            alert.textContent = message;
            alert.style.display = 'block';
            hideSuccess();
        }

        function hideSuccess() {
            document.getElementById('alert-success').style.display = 'none';
        }

        function hideError() {
            document.getElementById('alert-danger').style.display = 'none';
        }

        // Test functions
        function testConnection() {
            console.log('ğŸ”˜ testConnection clicked');
            showLoading();
            
            try {
                google.script.run
                    .withSuccessHandler(function(result) {
                        console.log('âœ… Connection test success:', result);
                        hideLoading();
                        showSuccess('âœ… é€£æ¥æˆåŠŸï¼ | Connection successful!');
                    })
                    .withFailureHandler(function(error) {
                        console.error('âŒ Connection test failed:', error);
                        hideLoading();
                        showError('âŒ é€£æ¥å¤±æ•—ï¼š' + error.message);
                    })
                    .getSystemVersion();
            } catch (error) {
                console.error('âŒ google.script.run error:', error);
                hideLoading();
                showError('âŒ å‘¼å«éŒ¯èª¤ï¼š' + error.message);
            }
        }

        function testInitialize() {
            console.log('ğŸ”˜ testInitialize clicked');
            if (!confirm('æ¸¬è©¦åˆå§‹åŒ–ç³»çµ±ï¼Ÿ')) return;
            
            showLoading();
            try {
                google.script.run
                    .withSuccessHandler(function(result) {
                        console.log('âœ… Initialize success:', result);
                        hideLoading();
                        showSuccess('âœ… åˆå§‹åŒ–æˆåŠŸï¼');
                    })
                    .withFailureHandler(function(error) {
                        console.error('âŒ Initialize failed:', error);
                        hideLoading();
                        showError('âŒ åˆå§‹åŒ–å¤±æ•—ï¼š' + error.message);
                    })
                    .initializeSystem();
            } catch (error) {
                console.error('âŒ Initialize call error:', error);
                hideLoading();
                showError('âŒ å‘¼å«åˆå§‹åŒ–éŒ¯èª¤ï¼š' + error.message);
            }
        }

        function testBatchCreate() {
            console.log('ğŸ”˜ testBatchCreate clicked');
            if (!confirm('æ¸¬è©¦æ‰¹é‡å»ºç«‹æˆç¸¾ç°¿ï¼Ÿé€™å¯èƒ½éœ€è¦å¹¾åˆ†é˜ã€‚')) return;
            
            showLoading();
            try {
                google.script.run
                    .withSuccessHandler(function(result) {
                        console.log('âœ… Batch create success:', result);
                        hideLoading();
                        if (result && result.success) {
                            showSuccess(`âœ… å»ºç«‹æˆåŠŸï¼š${result.successCount} å€‹æˆç¸¾ç°¿`);
                        } else {
                            showError('âŒ æ‰¹é‡å»ºç«‹å¤±æ•—ï¼š' + (result.error || 'æœªçŸ¥éŒ¯èª¤'));
                        }
                    })
                    .withFailureHandler(function(error) {
                        console.error('âŒ Batch create failed:', error);
                        hideLoading();
                        showError('âŒ æ‰¹é‡å»ºç«‹å¤±æ•—ï¼š' + error.message);
                    })
                    .batchCreateGradebooks();
            } catch (error) {
                console.error('âŒ Batch create call error:', error);
                hideLoading();
                showError('âŒ å‘¼å«æ‰¹é‡å»ºç«‹éŒ¯èª¤ï¼š' + error.message);
            }
        }

        function openProgressAudit() {
            console.log('ğŸ”˜ openProgressAudit clicked');
            showSuccess('âœ… é€²åº¦ç¨½æ ¸åŠŸèƒ½é»æ“Šæ­£å¸¸ï¼');
        }

        // Initialize when DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… Test dashboard DOM loaded');
            console.log('Google script available:', typeof google !== 'undefined' && typeof google.script !== 'undefined');
        });

        console.log('âœ… Test dashboard script loaded successfully!');
    </script>
</body>
</html>